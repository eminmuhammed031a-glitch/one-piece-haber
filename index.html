<!DOCTYPE html>
<html lang="tr">
<head>
    <link rel="icon" type="image/jpeg" href="hatayy.jpg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Piece Haber | Yeni DÃ¼nya</title>
    
    <meta name="description" content="TÃ¼rkiye'nin en gÃ¼ncel One Piece haber kaynaÄŸÄ±. Manga 1174 spoiler, anime yeni sezon tarihleri, teoriler, karakter analizleri, SBS Ã§evirileri ve canlÄ± sohbet.">
    <meta name="keywords" content="One Piece, One Piece Haber, Manga Spoiler, Anime Ä°zle, Luffy, Zoro, Shanks, Elbaf, One Piece Teorileri, 1174. BÃ¶lÃ¼m, One Piece Oku">
    <meta name="author" content="One Piece Haber Ekibi">
    <meta name="robots" content="index, follow">
    
    <meta property="og:title" content="One Piece Haber | Yeni DÃ¼nya">
    <meta property="og:description" content="En gÃ¼ncel manga spoilerlarÄ±, anime haberleri ve teoriler burada!">
    <meta property="og:image" content="https://static.wikia.nocookie.net/onepiece/images/c/c5/Revolutionary_Army_Jolly_Roger.png">

    <link rel="icon" href="https://static.wikia.nocookie.net/onepiece/images/c/c5/Revolutionary_Army_Jolly_Roger.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS AYARLARI --- */
        :root { --bg-paper: #f4e4bc; --bg-dark: #2c241b; --ocean-blue: #006994; --luffy-red: #d62828; --gold: #ffb703; --text-main: #3e2723; --font-heading: 'Pirata One', cursive; --font-body: 'Roboto', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg-paper); color: var(--text-main); font-family: var(--font-body); line-height: 1.6; background-image: radial-gradient(#e6d5a8 15%, transparent 16%), radial-gradient(#e6d5a8 15%, transparent 16%); background-size: 60px 60px; background-position: 0 0, 30px 30px; padding-bottom: 50px; }
        header { background-color: var(--bg-dark); color: var(--gold); padding: 1rem 2rem; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.5); display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--luffy-red); }
        .logo { font-family: var(--font-heading); font-size: 2rem; display: flex; align-items: center; gap: 10px; cursor: pointer; letter-spacing: 2px; }
        nav ul { display: flex; list-style: none; gap: 20px; align-items: center; }
        nav a { color: #fdf5e6; text-decoration: none; font-weight: bold; font-size: 1.1rem; transition: 0.3s; text-transform: uppercase; }
        nav a:hover { color: var(--gold); text-shadow: 0 0 5px var(--gold); }
        .login-btn { background: var(--luffy-red); color: white; padding: 5px 15px; border-radius: 5px; cursor: pointer; border: 2px solid white; font-family: var(--font-heading); font-size: 1.2rem; }
        .user-profile-mini { display: flex; align-items: center; gap: 10px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 20px; transition: 0.3s; border: 1px solid var(--gold); }
        .user-profile-mini:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
        .user-avatar-small { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--gold); background: white; object-fit: cover; }
        section { padding: 4rem 2rem; max-width: 1200px; margin: 0 auto; }
        .section-title { font-family: var(--font-heading); font-size: 3rem; text-align: center; margin-bottom: 3rem; color: var(--bg-dark); text-shadow: 2px 2px 0px rgba(255,255,255,0.4); border-bottom: 2px solid var(--luffy-red); display: inline-block; left: 50%; position: relative; transform: translateX(-50%); }
        
        /* NEWS CARDS */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .news-card { background: #fff; border: 2px solid var(--bg-dark); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; transition: transform 0.3s; box-shadow: 5px 5px 0 rgba(0,0,0,0.2); height: 100%; cursor: pointer; }
        .news-card:hover { transform: translateY(-5px); box-shadow: 8px 8px 0 rgba(0,0,0,0.3); }
        
        .news-img-placeholder { 
            height: 200px; 
            display: flex; align-items: flex-end; justify-content: flex-start; 
            color: white; font-family: var(--font-heading); font-size: 2rem; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9); 
            background-size: cover; 
            background-position: top center; 
            padding: 10px; position: relative;
            background-color: #333; 
        }
        .news-img-placeholder::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; background: linear-gradient(transparent, rgba(0,0,0,0.9)); }
        .news-title-overlay { position: relative; z-index: 2; }
        
        .news-content { padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; }
        .tag { display: inline-block; background: var(--bg-dark); color: var(--gold); padding: 4px 8px; font-size: 0.75rem; border-radius: 4px; margin-bottom: 10px; width: fit-content; font-weight: bold;}
        .news-content h3 { font-family: var(--font-heading); font-size: 1.6rem; color: var(--luffy-red); margin-bottom: 0.8rem; line-height: 1.1; }
        .news-content p { font-size: 0.95rem; color: #444; margin-bottom: 1.5rem; flex-grow: 1; }
        .read-more { text-align: center; background: var(--ocean-blue); color: white; padding: 8px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: auto; }
        .read-more:hover { background: var(--bg-dark); }
        
        /* Games */
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .game-item { background: #fff; padding: 15px; border-radius: 8px; border: 1px solid var(--text-main); display: flex; flex-direction: column; gap: 10px; transition: 0.3s; }
        .game-item:hover { transform: translateY(-3px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .game-header { display: flex; justify-content: space-between; align-items: center; }
        .game-title { font-family: var(--font-heading); font-size: 1.4rem; color: var(--ocean-blue); }
        .game-platform { font-size: 0.75rem; font-weight: bold; padding: 2px 6px; border-radius: 4px; color: white; }
        .plat-mobile { background: #e67e22; }
        .plat-roblox { background: #e74c3c; }
        
        /* Quiz */
        #quiz-game { background: rgba(255, 255, 255, 0.6); border-radius: 20px; border: 3px dashed var(--bg-dark); padding: 2rem; margin-top: 2rem; }
        .quiz-container { max-width: 800px; margin: 0 auto; text-align: center; }
        .quiz-question { font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; color: var(--bg-dark); }
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .quiz-btn { padding: 15px; background: var(--bg-dark); color: var(--gold); border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; transition: 0.2s; font-family: var(--font-body); }
        .quiz-btn:hover { background: var(--luffy-red); color: white; transform: scale(1.02); }
        .quiz-score { font-family: var(--font-heading); font-size: 2rem; margin-top: 20px; color: var(--ocean-blue); }
        .feedback { margin-top: 15px; font-weight: bold; min-height: 30px; }
        
        /* Fruit */
        #fruit-game { text-align: center; margin-top: 3rem; border-top: 2px solid var(--luffy-red); padding-top: 2rem; }
        .fruit-box { background: #fff; border: 4px double var(--bg-dark); width: 300px; height: 300px; margin: 20px auto; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 50%; box-shadow: 0 0 20px rgba(0,0,0,0.2); transition: 0.5s; position: relative;}
        .fruit-name { font-family: var(--font-heading); font-size: 2rem; color: var(--luffy-red); margin-bottom: 10px; }
        .fruit-type { background: var(--gold); color: var(--bg-dark); padding: 2px 10px; border-radius: 20px; font-weight: bold; font-size: 0.9rem;}
        .fruit-desc { font-size: 0.9rem; padding: 10px; color: #555; }
        .fruit-chance { position: absolute; bottom: 30px; font-size: 0.8rem; color: #999; }
        .spin-btn { padding: 10px 30px; background: var(--ocean-blue); color: white; border: none; font-size: 1.2rem; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #003049; }
        .spin-btn:active { transform: translateY(4px); box-shadow: none; }
        .spin-limit { margin-top: 10px; font-size: 0.9rem; color: #555; }
        
        #leaderboard, #guilds { background: #fff; border: 2px solid var(--bg-dark); border-radius: 10px; padding: 2rem; max-width: 800px; margin: 3rem auto; }
        .rank-table { width: 100%; border-collapse: collapse; }
        .rank-table th { background: var(--bg-dark); color: var(--gold); padding: 10px; text-align: left; }
        .rank-table td { padding: 10px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        .current-user-row { background: #e3f2fd; font-weight: bold; border: 2px solid var(--ocean-blue); }
        .guild-flag { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--gold); margin-right: 10px; vertical-align: middle; }
        .role-badge { font-size: 0.7rem; padding: 2px 4px; border-radius: 4px; color: white; margin-left: 5px; }
        .role-captain { background: #d62828; } .role-righthand { background: #e67e22; } .role-lefthand { background: #f1c40f; color: black; } .role-senior { background: #2980b9; } .role-member { background: #95a5a6; }

        /* CHAT */
        #chat-section { 
            background: linear-gradient(rgba(255,255,255,0.6), rgba(255,255,255,0.6)), url('xebec.jpg');
            background-size: cover; background-position: top center;
            padding: 2rem; border: 3px solid var(--bg-dark); border-radius: 10px; max-width: 800px; margin: 3rem auto; 
        }
        #chat-box { height: 300px; overflow-y: auto; border: 1px solid #ccc; background: rgba(255,255,255,0.85); padding: 10px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { max-width: 70%; padding: 8px 12px; border-radius: 10px; font-size: 0.9rem; position: relative; }
        .msg-other { background: #eee; align-self: flex-start; border-bottom-left-radius: 0; }
        .msg-me { background: var(--ocean-blue); color: white; align-self: flex-end; border-bottom-right-radius: 0; }
        .msg-sender { font-size: 0.7rem; font-weight: bold; margin-bottom: 2px; display: block; }
        .chat-input-area { display: flex; gap: 10px; }
        
        #post-wall { background: #fff; padding: 2rem; border-radius: 10px; border: 2px solid var(--bg-dark); max-width: 800px; margin: 3rem auto; }
        .post-input-box { background: #eee; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .post-card { border-bottom: 1px solid #ddd; padding: 15px 0; }
        .post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .post-author { font-weight: bold; color: var(--ocean-blue); }
        .post-time { font-size: 0.8rem; color: #777; }
        .post-title { font-family: var(--font-heading); font-size: 1.3rem; color: var(--luffy-red); margin: 0; }
        .post-body { font-size: 0.95rem; margin: 5px 0; }
        .post-actions { margin-top: 5px; }
        .btn-respect { background: var(--gold); border: none; padding: 5px 10px; border-radius: 20px; font-weight: bold; cursor: pointer; color: var(--bg-dark); }
        .btn-respect:hover { background: #e6a800; }

        #weekly-poll { background: var(--bg-dark); color: white; padding: 2rem; border-radius: 10px; max-width: 800px; margin: 3rem auto; text-align: center; }
        .poll-options { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .poll-option { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; cursor: pointer; text-align: left; position: relative; overflow: hidden; }
        .poll-option:hover { background: rgba(255,255,255,0.2); }
        .poll-bar { position: absolute; top: 0; left: 0; height: 100%; background: rgba(214, 40, 40, 0.5); z-index: 0; transition: width 0.5s; width: 0%; }
        .poll-text { position: relative; z-index: 1; display: flex; justify-content: space-between; }

        #countdown-section { 
            background: linear-gradient(rgba(44, 36, 27, 0.6), rgba(44, 36, 27, 0.6)), url('aokiji.jpg');
            background-size: cover; background-position: top center;
            color: #fff; margin-top: 4rem; border-radius: 10px; text-align: center; border-top: 5px solid var(--gold); padding-bottom: 3rem; 
        }
        #countdown-section .section-title { color: var(--gold); border-bottom: none; text-shadow: none; }
        .timers-wrapper { display: flex; justify-content: center; flex-wrap: wrap; gap: 2rem; }
        .timer-box { background: rgba(255,255,255,0.05); padding: 2rem; border-radius: 10px; min-width: 250px; border: 1px solid rgba(255,255,255,0.1); }
        .timer-title { color: var(--ocean-blue); font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; text-transform: uppercase; }
        .timer-display { font-family: monospace; font-size: 1.5rem; color: var(--gold); font-weight: bold; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal-content { background: var(--bg-paper); padding: 2rem; border-radius: 10px; max-width: 800px; width: 90%; position: relative; border: 4px solid var(--bg-dark); max-height: 80vh; overflow-y: auto; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .close-modal { position: absolute; top: 10px; right: 20px; font-size: 2.5rem; cursor: pointer; color: var(--luffy-red); font-weight: bold; }
        .modal-body h2 { font-family: var(--font-heading); margin-bottom: 1rem; color: var(--bg-dark); border-bottom: 2px solid var(--luffy-red); }
        .modal-body h3 { font-family: var(--font-heading); margin-top: 1.5rem; color: var(--ocean-blue); }
        .modal-body ul { padding-left: 20px; }
        .modal-body li { margin-bottom: 5px; color: #333; }
        .modal-body p { margin-bottom: 1rem; color: #333; font-size: 1rem; }
        .sbs-item { margin-bottom: 20px; border-bottom: 1px dashed #ccc; padding-bottom: 10px; }
        .sbs-q { font-weight: bold; color: var(--ocean-blue); display: block; margin-bottom: 5px; }
        .sbs-q::before { content: 'S: '; color: var(--text-main); }
        .sbs-a { font-style: italic; margin-left: 15px; display: block; }
        .sbs-a::before { content: 'O: '; font-weight: bold; font-style: normal; }
        .auth-form input, .auth-form textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 2px solid var(--bg-dark); border-radius: 5px; font-family: var(--font-body); }
        .auth-form label { font-weight: bold; display: block; margin-bottom: 5px; color: var(--bg-dark); }
        .auth-btn { width: 100%; padding: 12px; background: var(--luffy-red); color: white; border: none; font-weight: bold; cursor: pointer; font-size: 1.1rem; margin-top: 10px; transition: 0.3s;}
        .auth-btn:hover { background: #b71c1c; }
        .auth-toggle { display: flex; gap: 10px; margin-bottom: 20px; }
        .auth-toggle button { flex: 1; padding: 10px; background: #ddd; border: none; cursor: pointer; font-weight: bold; }
        .auth-toggle button.active { background: var(--ocean-blue); color: white; }
        .wanted-poster { background: #fff; border: 5px solid #5a4a3a; padding: 20px; text-align: center; max-width: 350px; margin: 0 auto; box-shadow: 5px 5px 15px rgba(0,0,0,0.3); position: relative; }
        .wanted-header { font-family: serif; font-size: 2.5rem; letter-spacing: 5px; color: #5a4a3a; margin-bottom: 10px; }
        .wanted-img { width: 100%; height: 250px; object-fit: cover; background: #ccc; border: 2px solid #5a4a3a; }
        .wanted-name { font-family: var(--font-heading); font-size: 2rem; text-transform: uppercase; margin: 10px 0; line-height: 1; }
        .wanted-bounty { font-family: serif; font-size: 1.2rem; color: #5a4a3a; border-top: 2px solid #5a4a3a; padding-top: 5px; }
        .bounty-amount { font-family: var(--font-heading); font-size: 2rem; color: #5a4a3a; }
        .bio-text { font-size: 0.9rem; color: #555; margin-top: 10px; font-style: italic; white-space: pre-wrap; }
        .friend-list { margin-top: 15px; text-align: left; border-top: 1px solid #ccc; padding-top: 10px; }
        .friend-list ul { list-style: none; padding: 0; max-height: 150px; overflow-y: auto; }
        .friend-list li { background: #f0f0f0; margin-bottom: 5px; padding: 5px; border-radius: 5px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 5px;}
        .friend-list li:hover { background: #e0e0e0; }
        .friend-actions { margin-left: auto; display: flex; gap: 5px; }
        .btn-tiny { padding: 2px 6px; font-size: 0.7rem; border: none; border-radius: 4px; cursor: pointer; color: white;}
        .btn-accept { background: green; } .btn-decline { background: red; } .btn-remove { background: #555; }
        .fruit-badge { background: var(--gold); color: black; font-size: 0.8rem; padding: 3px 8px; border-radius: 10px; font-weight: bold; display: inline-block; margin-top: 5px;}
        
        .guild-tab-content { display:none; margin-top:15px; border-top: 2px solid #333; padding-top:15px; }
        .guild-tab-content.active { display:block; }
        .tab-btn-group { display:flex; gap:5px; margin-bottom:10px; }
        .tab-btn { flex:1; padding:5px; border:1px solid #ccc; background:#eee; cursor:pointer; font-weight: bold;}
        .tab-btn.active { background:var(--luffy-red); color:white; border-color:var(--luffy-red); }

        footer { text-align: center; margin-top: 50px; color: #666; font-size: 0.9rem; }
        @media (max-width: 768px) { header { flex-direction: column; gap: 10px; } .quiz-options { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header>
        <div class="logo">â˜ ï¸ ONE PIECE HABER</div>
        <nav>
            <ul>
                <li><a href="#chat-section">Sohbet</a></li>
                <li><a href="#guilds">Ä°ttifak</a></li>
                <li><a href="#post-wall">KÃ¶ÅŸe</a></li>
                <li><a href="#leaderboard">SÄ±ralama</a></li>
                <li id="auth-section">
                    <button class="login-btn" onclick="openLoginModal()">GiriÅŸ / KayÄ±t</button>
                </li>
            </ul>
        </nav>
    </header>

    <section id="chat-section">
        <h2 class="section-title">Denizci Salyangozu (Chat)</h2>
        <div id="chat-box"><div style="text-align:center; color:gray;">BaÄŸlanÄ±yor...</div></div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="MesajÄ±nÄ± yaz korsan..." style="flex-grow:1; padding:10px;">
            <button class="auth-btn" style="width:auto; margin:0;" onclick="sendMessage()">GÃ¶nder</button>
        </div>
    </section>

    <section id="news">
        <h2 class="section-title">Grand Line'dan Son Dakika</h2>
        <div class="news-grid">
            <article class="news-card" onclick="openModal('manga')">
                <div class="news-img-placeholder" style="background-image: url('luffy3.jpg');">
                    <span class="news-title-overlay">ELBAF</span>
                </div>
                <div class="news-content">
                    <span class="tag">Manga Spoiler</span>
                    <h3>BÃ¶lÃ¼m 1174 ve "BÃ¼yÃ¼k Mola"</h3>
                    <p>Manga ÅŸu an Elbaf ArkÄ±'nÄ±n zirvesinde. 1174. BÃ¶lÃ¼m'Ã¼n yarÄ±n yayÄ±nlanmasÄ± bekleniyor.</p>
                    <div class="read-more">Ã–zeti Oku</div>
                </div>
            </article>
            <article class="news-card" onclick="openModal('sbs')">
                <div class="news-img-placeholder" style="background-image: url('robin.jpg');">
                    <span class="news-title-overlay">SBS</span>
                </div>
                <div class="news-content">
                    <span class="tag">SBS Ã–zel</span>
                    <h3>Karakter SÄ±rlarÄ±</h3>
                    <p>Oda-sensei'den ÅŸok cevaplar! Banyo yapma sÄ±klÄ±klarÄ±, karakterlerin gerÃ§ek hayattaki Ã¼lkeleri...</p>
                    <div class="read-more">TamamÄ±nÄ± Oku</div>
                </div>
            </article>
            <article class="news-card" onclick="openModal('anime')">
                <div class="news-img-placeholder" style="background-image: url('zoro.jpg');">
                    <span class="news-title-overlay">ANIME</span>
                </div>
                <div class="news-content">
                    <span class="tag">Anime</span>
                    <h3>Anime DÃ¶nÃ¼ÅŸÃ¼</h3>
                    <p>Nisan ayÄ±nda Elbaf Arc baÅŸlÄ±yor! Wit Studio'nun "The One Piece" remake projesi sessizliÄŸini koruyor.</p>
                    <div class="read-more">Detaylar</div>
                </div>
            </article>
        </div>
    </section>

    <section id="post-wall">
        <h2 class="section-title">Grand Line KÃ¶ÅŸe YazarlarÄ±</h2>
        <div class="post-input-box">
            <input type="text" id="post-title" placeholder="BaÅŸlÄ±k (Ã–rn: Shanks'Ä±n PlanÄ±)" style="width:100%; padding:10px; margin-bottom:5px;">
            <textarea id="post-content" rows="3" placeholder="Teorini veya haberini buraya yaz..." style="width:100%; padding:10px;"></textarea>
            <button class="auth-btn" style="width:auto; margin-top:5px;" onclick="createPost()">PaylaÅŸ</button>
        </div>
        <div id="posts-feed">
            <div style="text-align:center; color:gray;">YazÄ±lar yÃ¼kleniyor...</div>
        </div>
    </section>

    <section id="weekly-poll">
        <h2 class="section-title" style="color:var(--gold); border:none;">ğŸ“Š HaftanÄ±n Anketi</h2>
        <h3>Korsanlar KralÄ± Kim Olacak?</h3>
        <div class="poll-options" id="poll-options-container"></div>
    </section>

    <section id="guilds">
        <h2 class="section-title">En GÃ¼Ã§lÃ¼ Ä°ttifaklar</h2>
        <table class="rank-table">
            <thead><tr><th>#</th><th>Bayrak</th><th>Ä°ttifak AdÄ±</th><th>Toplam Ã–dÃ¼l</th></tr></thead>
            <tbody id="guild-leaderboard"><tr><td colspan="4" style="text-align:center;">YÃ¼kleniyor...</td></tr></tbody>
        </table>
    </section>

    <section id="leaderboard">
        <h2 class="section-title">DÃ¼nya SÄ±ralamasÄ± (Top 50)</h2>
        <div style="overflow-x:auto;">
            <table class="rank-table">
                <thead><tr><th>#</th><th>Korsan AdÄ±</th><th>Ã–dÃ¼l (Bounty)</th><th>Meyve</th></tr></thead>
                <tbody id="leaderboard-body"><tr><td colspan="4" style="text-align:center;">VeritabanÄ±na baÄŸlanÄ±yor...</td></tr></tbody>
            </table>
        </div>
    </section>

    <section id="games">
        <h2 class="section-title">Korsan OyunlarÄ±</h2>
        <div class="games-grid">
            <div class="game-item"><div class="game-header"><span class="game-title">OP: Bounty Rush</span><span class="game-platform plat-mobile">Mobil</span></div><p>4v4 Bayrak kapma oyunu. Yeni Elbaf karakterleri metayÄ± sallÄ±yor.</p></div>
            <div class="game-item"><div class="game-header"><span class="game-title">Project: Fighter</span><span class="game-platform plat-mobile">Mobil</span></div><p>Tencent yapÄ±mÄ±, inanÄ±lmaz grafikli dÃ¶vÃ¼ÅŸ oyunu.</p></div>
            <div class="game-item" style="border-color: #e74c3c;"><div class="game-header"><span class="game-title">Blox Fruits</span><span class="game-platform plat-roblox">Roblox</span></div><p>Roblox'un en popÃ¼leri. Yeni Kitsune meyvesi ve Dragon rework gÃ¼ndemde.</p></div>
            <div class="game-item" style="border-color: #e74c3c;"><div class="game-header"><span class="game-title">King Legacy</span><span class="game-platform plat-roblox">Roblox</span></div><p>Yeni boss raidleri ile oyuncu sayÄ±sÄ±nÄ± artÄ±rdÄ±. Grind sevenler iÃ§in.</p></div>
            <div class="game-item" style="border-color: #e74c3c;"><div class="game-header"><span class="game-title">Fruit Battlegrounds</span><span class="game-platform plat-roblox">Roblox</span></div><p>Tamamen PVP odaklÄ±. Nika meyvesini uyandÄ±rmak iÃ§in savaÅŸ.</p></div>
        </div>
    </section>

    <section id="quiz-game">
        <h2 class="section-title">Grand Line Bilgi YarÄ±ÅŸmasÄ±</h2>
        <div class="quiz-container">
            <div class="quiz-score">KazanÄ±lan Bounty: <span id="current-score" style="color:var(--luffy-red)">0</span> à¸¿</div>
            <p style="margin-bottom:20px; color:#666;">40 sorudan rastgele 10 tanesi sorulur!</p>
            <div id="quiz-box">
                <div class="quiz-question" id="question-text">Soru YÃ¼kleniyor...</div>
                <div class="quiz-options">
                    <button class="quiz-btn" onclick="checkAnswer(0)">A</button><button class="quiz-btn" onclick="checkAnswer(1)">B</button>
                    <button class="quiz-btn" onclick="checkAnswer(2)">C</button><button class="quiz-btn" onclick="checkAnswer(3)">D</button>
                </div>
                <div class="feedback" id="feedback-text"></div>
            </div>
        </div>
    </section>

    <section id="fruit-game">
        <h2 class="section-title">Åeytan Meyveni KeÅŸfet</h2>
        <p>Dikkat! Yeni meyve Ã§Ä±karsa eskisinin puanÄ± silinir, yenisi eklenir!</p>
        <div class="fruit-box" id="fruit-display">
            <div class="fruit-name">?</div>
            <div class="fruit-desc">Ã‡evirmek iÃ§in butona bas!</div>
        </div>
        <button class="spin-btn" onclick="spinFruit()">Ã‡arkÄ± Ã‡evir</button>
        <div class="spin-limit">Kalan HakkÄ±n: <span id="spin-count">3</span></div>
    </section>

    <section id="countdown-section">
        <h2 class="section-title">Geri SayÄ±m</h2>
        <div class="timers-wrapper">
            <div class="timer-box"><div class="timer-title">Manga 1175</div><div class="timer-display" id="manga-timer">...</div><small>Tahmini PerÅŸembe</small></div>
            <div class="timer-box"><div class="timer-title">Live Action S2</div><div class="timer-display" id="la-timer">...</div><small>10 Mart 2026</small></div>
            <div class="timer-box"><div class="timer-title">Anime Yeni Sezon</div><div class="timer-display" id="anime-timer">HesaplanÄ±yor...</div><small>Nisan 2026</small></div>
        </div>
    </section>

    <footer><p>&copy; 2026 One Piece Haber. Fan YapÄ±mÄ±dÄ±r.</p></footer>

    <div class="modal-overlay" id="infoModal"><div class="modal-content"><span class="close-modal" onclick="closeModal('infoModal')">Ã—</span><div class="modal-body" id="modalBody"></div></div></div>
    
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-modal" onclick="closeModal('loginModal')">Ã—</span>
            <h2 style="text-align: center; font-family: var(--font-heading);">Korsan Pasaportu</h2>
            <div class="auth-toggle">
                <button id="btn-show-login" class="active" onclick="switchAuthMode('login')">GiriÅŸ Yap</button>
                <button id="btn-show-register" onclick="switchAuthMode('register')">KayÄ±t Ol</button>
            </div>
            <div id="login-form" class="auth-form">
                <label>KullanÄ±cÄ± AdÄ±:</label><input type="text" id="login-name" placeholder="AdÄ±n...">
                <label>Åifre:</label><input type="password" id="login-pass" placeholder="Åifren...">
                <button class="auth-btn" onclick="performLogin()">GiriÅŸ Yap</button>
            </div>
            <div id="register-form" class="auth-form" style="display:none;">
                <label>KullanÄ±cÄ± AdÄ± Belirle:</label><input type="text" id="reg-name" placeholder="Yeni korsan adÄ±...">
                <label>Åifre Belirle:</label><input type="password" id="reg-pass" placeholder="GÃ¼Ã§lÃ¼ bir ÅŸifre...">
                <label>HakkÄ±nda:</label><textarea id="reg-bio" rows="2" placeholder="Ã–rn: GeleceÄŸin Korsanlar KralÄ±"></textarea>
                <label>Profil Resmi (CihazÄ±ndan):</label><input type="file" id="reg-file" accept="image/*" onchange="previewImage()">
                <div style="text-align:center;"><img id="img-preview" src="https://static.wikia.nocookie.net/onepiece/images/c/c5/Revolutionary_Army_Jolly_Roger.png" style="width:80px;height:80px;border-radius:50%;display:none;margin:10px auto;border:2px solid #333;object-fit:cover;"></div>
                <button class="auth-btn" onclick="performRegister()">KayÄ±t Ol</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="profileModal">
        <div class="modal-content" style="max-width: 500px; background: transparent; box-shadow: none; border: none;">
            <span class="close-modal" onclick="closeModal('profileModal')" style="color: white; z-index: 2001;">Ã—</span>
            <div class="wanted-poster">
                <div class="wanted-header">WANTED</div><div style="font-size:0.8rem;">DEAD OR ALIVE</div>
                <img id="profile-img" class="wanted-img" src=""><div id="profile-name" class="wanted-name"></div>
                <div class="wanted-bounty">à¸¿ <span id="profile-bounty" class="bounty-amount"></span> -</div>
                <div id="profile-fruit" class="fruit-badge" style="display:none;"></div>
                <p id="profile-bio" class="bio-text"></p>

                <div class="tab-btn-group" style="margin-top:15px;">
                    <button class="tab-btn active" onclick="showTab('friends')">Tayfa</button>
                    <button class="tab-btn" onclick="showTab('guild')">Ä°ttifak</button>
                </div>

                <div id="tab-friends" class="guild-tab-content active">
                    <strong>Gelen Ä°stekler:</strong><ul id="request-ul" style="border-bottom:1px dashed #5a4a3a; margin-bottom:10px; padding-bottom:5px;"></ul>
                    <strong>Dostlar (Ekle):</strong>
                    <div style="display:flex; gap:5px; margin-bottom:5px;"><input type="text" id="friend-input" placeholder="Ä°sim Gir..." style="width:70%;padding:5px;"><button onclick="sendFriendRequest()" style="padding:5px;cursor:pointer;">EKLE</button></div>
                    <ul id="friend-ul"></ul>
                </div>

                <div id="tab-guild" class="guild-tab-content">
                    <div id="guild-status-area">
                        <p style="font-size:0.9rem;">Bir ittifaka katÄ±l veya kendininkini kur!</p>
                        <div style="background:#eee; padding:10px; border-radius:5px; margin-bottom:10px;">
                            <strong>Yeni Ä°ttifak Kur:</strong>
                            <input type="text" id="guild-create-input" placeholder="Ä°sim" style="padding:5px; width:100%; margin:5px 0;">
                            <textarea id="guild-desc-input" placeholder="AÃ§Ä±klama" style="width:100%; height:40px; margin-bottom:5px;"></textarea>
                            <label style="font-size:0.8rem;">Bayrak SeÃ§:</label>
                            <input type="file" id="guild-flag-input" accept="image/*" style="font-size:0.8rem;">
                            <button onclick="createGuild()" style="width:100%; padding:5px; cursor:pointer; background:var(--luffy-red); color:white; border:none; margin-top:5px;">KUR</button>
                        </div>
                        <div style="display:flex; gap:5px;"><input type="text" id="guild-join-input" placeholder="Mevcut Ä°ttifak AdÄ±" style="padding:5px; width:70%;"><button onclick="joinGuild()" style="padding:5px; cursor:pointer; width:30%;">KATIL</button></div>
                    </div>
                    <div id="my-guild-info" style="display:none;">
                        <img id="g-flag-display" class="guild-flag" src="" style="width:60px; height:60px; display:block; margin:0 auto;">
                        <h3 id="g-name" style="color:var(--luffy-red); margin:5px 0;"></h3>
                        <p id="g-desc" style="font-size:0.8rem; font-style:italic; color:#555;"></p>
                        <p style="font-size:0.8rem;">Kaptan: <span id="g-captain"></span></p>
                        <p style="font-size:0.8rem;">Toplam Ã–dÃ¼l: <span id="g-bounty"></span> à¸¿</p>
                        <hr>
                        <div style="max-height:150px; overflow-y:auto; border:1px solid #ddd; padding:5px;">
                            <ul id="g-members" style="list-style:none; padding:0; font-size:0.8rem; text-align:left;"></ul>
                        </div>
                        <button onclick="leaveGuild()" style="width:100%; margin-top:5px; background:#555; color:white; border:none; padding:5px; cursor:pointer;">Ä°ttifaktan AyrÄ±l</button>
                    </div>
                </div>

            </div>
            <button onclick="enableEdit()" style="width:100%;margin-top:10px;padding:10px;background:#006994;color:white;border:none;cursor:pointer;font-weight:bold;">Profili DÃ¼zenle</button>
            <button onclick="performLogout()" style="width:100%;margin-top:5px;padding:10px;background:#333;color:white;border:none;cursor:pointer;font-weight:bold;">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </div>
    </div>

    <div class="modal-overlay" id="viewFriendModal">
        <div class="modal-content" style="max-width: 400px; background: transparent; box-shadow: none; border: none;">
            <span class="close-modal" onclick="closeModal('viewFriendModal')" style="color: white; z-index: 2001;">Ã—</span>
            <div class="wanted-poster">
                <div class="wanted-header">FRIEND</div>
                <img id="view-img" class="wanted-img" src=""><div id="view-name" class="wanted-name"></div>
                <div class="wanted-bounty">à¸¿ <span id="view-bounty" class="bounty-amount"></span></div>
                <div id="view-fruit" class="fruit-badge" style="display:none;"></div>
                <p id="view-bio" class="bio-text"></p>
                <div style="margin-top:10px; font-weight:bold;" id="view-status"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editProfileModal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close-modal" onclick="closeModal('editProfileModal')">Ã—</span>
            <h3>Profili DÃ¼zenle</h3>
            <div class="auth-form">
                <label>Yeni HakkÄ±nda YazÄ±sÄ±:</label><textarea id="edit-bio" rows="3"></textarea>
                <label>Yeni Resim SeÃ§:</label><input type="file" id="edit-file" accept="image/*" onchange="previewEditImage()">
                <div style="text-align:center;"><img id="edit-preview" src="" style="width:80px;height:80px;border-radius:50%;margin:10px auto;border:2px solid #333;object-fit:cover;"></div>
                <button class="auth-btn" onclick="saveProfileEdit()">Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        const allQ = [ {q:"Luffyâ€™nin ÅŸeytan meyvesinin gerÃ§ek adÄ± nedir?", a:["Gomu Gomu no Mi","Hito Hito no Mi","Hito Hito no Mi, Model: Nika","Nika Nika no Mi"], c:2}, {q:"Zoroâ€™nun ustasÄ±nÄ±n adÄ± nedir?", a:["Mihawk","Koshiro","Rayleigh","Oden"], c:1}, {q:"Sanji hangi denizde doÄŸmuÅŸtur?", a:["West Blue","North Blue","South Blue","East Blue"], c:1}, {q:"Namiâ€™nin ilk baÄŸlÄ± olduÄŸu korsan kimdi?", a:["Arlong","Buggy","Crocodile","Don Krieg"], c:0}, {q:"Usoppâ€™un babasÄ±nÄ±n adÄ± nedir?", a:["Yasopp","Beckman","Lucky Roo","Shanks"], c:0}, {q:"Tony Tony Chopper hangi meyveyi yemiÅŸtir?", a:["Gomu Gomu no Mi","Hito Hito no Mi","Mera Mera no Mi","Ushi Ushi no Mi"], c:1}, {q:"Nico Robinâ€™in ilk Ã¶rgÃ¼tÃ¼ hangisidir?", a:["CP9","Baroque Works","Donquixote Ailesi","Devrim Ordusu"], c:1}, {q:"Frankyâ€™nin gerÃ§ek adÄ± nedir?", a:["Iceburg","Cutty Flam","Tom","Paulie"], c:1}, {q:"Brook kaÃ§ yÄ±l boyunca tek baÅŸÄ±na denizde kalmÄ±ÅŸtÄ±r?", a:["10","20","30","50"], c:3}, {q:"Jinbe hangi Ä±rktandÄ±r?", a:["Dev","Mink","BalÄ±k Adam","Lunarian"], c:2}, {q:"Luffy ilk olarak hangi denizde yola Ã§Ä±ktÄ±?", a:["Grand Line","East Blue","West Blue","North Blue"], c:1}, {q:"Shanks hangi Yonko grubundadÄ±r?", a:["Beyazsakal KorsanlarÄ±","Big Mom KorsanlarÄ±","KÄ±zÄ±l SaÃ§ KorsanlarÄ±","Kara Sakal KorsanlarÄ±"], c:2}, {q:"Portgas D. Aceâ€™in ÅŸeytan meyvesi nedir?", a:["Magu Magu no Mi","Mera Mera no Mi","Gura Gura no Mi","Suna Suna no Mi"], c:1}, {q:"Whitebeardâ€™Ä±n gerÃ§ek adÄ± nedir?", a:["Edward Teach","Edward Newgate","Rocks D. Xebec","Marshall D. Teach"], c:1}, {q:"Enies Lobbyâ€™de Straw Hatâ€™lere karÅŸÄ± savaÅŸan CP9 lideri kimdi?", a:["Kaku","Jabra","Lucci","Spandam"], c:2}, {q:"Doflamingo hangi krallÄ±ÄŸÄ±n eski prensi?", a:["Alabasta","Dressrosa","Wano","Drum"], c:1}, {q:"Wanoâ€™nun eski shogunu kimdi?", a:["Orochi","Oden","Kaido","Momonosuke"], c:1}, {q:"Kaido hangi meyveye sahiptir?", a:["Ryu Ryu no Mi","Uo Uo no Mi, Model: Seiryu","Hebi Hebi no Mi","Tori Tori no Mi"], c:1}, {q:"Big Momâ€™un gerÃ§ek adÄ± nedir?", a:["Charlotte Smoothie","Charlotte Linlin","Streusen","Perospero"], c:1}, {q:"Trafalgar Lawâ€™un meyvesi nedir?", a:["Ope Ope no Mi","Ito Ito no Mi","Yami Yami no Mi","Bari Bari no Mi"], c:0}, {q:"Blackbeard kaÃ§ ÅŸeytan meyvesi gÃ¼cÃ¼ne sahiptir?", a:["1","2","3","4"], c:1}, {q:"Gol D. Rogerâ€™Ä±n lakabÄ± nedir?", a:["AltÄ±n Aslan","Korsan Kral","Deniz ÅeytanÄ±","Efsanevi KÄ±lÄ±Ã§ UstasÄ±"], c:1}, {q:"One Piece hazinesinin bulunduÄŸu ada?", a:["Raftel","Laugh Tale","Lodestar","Elbaf"], c:1}, {q:"Sabo hangi Ã¶rgÃ¼tÃ¼n Ã¼yesidir?", a:["CP0","Devrim Ordusu","Marine","Baroque Works"], c:1}, {q:"Monkey D. Dragon kimdir?", a:["Amiral","Yonko","Devrim Ordusu lideri","Shichibukai"], c:2}, {q:"En gÃ¼Ã§lÃ¼ denizci unvanÄ± nedir?", a:["Koramiral","Filo Amiral","Amiral","YÃ¼zbaÅŸÄ±"], c:1}, {q:"Luffyâ€™nin Gear 2 tekniÄŸini ilk kullandÄ±ÄŸÄ± yer?", a:["Alabasta","Enies Lobby","Thriller Bark","Marineford"], c:1}, {q:"Zoroâ€™nun â€œEnmaâ€ kÄ±lÄ±cÄ± nereden gelmiÅŸtir?", a:["Mihawk","Wano","East Blue","Marine"], c:1}, {q:"Shichibukai sistemi kaÃ§ Ã¼yeden oluÅŸur?", a:["5","6","7","8"], c:2}, {q:"Akainuâ€™nun meyvesi nedir?", a:["Mera Mera no Mi","Magu Magu no Mi","Hie Hie no Mi","Pika Pika no Mi"], c:1}, {q:"Aokijiâ€™nin meyvesi nedir?", a:["Hie Hie no Mi","Moku Moku no Mi","Suna Suna no Mi","Yami Yami no Mi"], c:0}, {q:"Kizaruâ€™nun meyvesi nedir?", a:["Pika Pika no Mi","Magu Magu no Mi","Ope Ope no Mi","Goro Goro no Mi"], c:0}, {q:"Enel hangi adada yaÅŸÄ±yordu?", a:["Skypiea","Dressrosa","Fishman Island","Zou"], c:0}, {q:"Crocodileâ€™Ä±n meyvesi nedir?", a:["Suna Suna no Mi","Ito Ito no Mi","Gura Gura no Mi","Doku Doku no Mi"], c:0}, {q:"Bartholomew Kumaâ€™nÄ±n meyvesi nedir?", a:["Paw Paw (Nikyu Nikyu no Mi)","Bari Bari no Mi","Hobi Hobi no Mi","Hana Hana no Mi"], c:0}, {q:"Mihawkâ€™Ä±n lakabÄ± nedir?", a:["Denizlerin Ä°mparatoru","En GÃ¼Ã§lÃ¼ KÄ±lÄ±Ã§ UstasÄ±","Kara ÅÃ¶valye","KÄ±zÄ±l Åahin"], c:1}, {q:"Wano Ã¼lkesinin kapalÄ± kalmasÄ±nÄ±n sebebi nedir?", a:["DÃ¼nya HÃ¼kÃ¼meti korkusu","Antik silah","Geleneksel izolasyon politikasÄ±","Deniz taÅŸlarÄ±"], c:2}, {q:"Joy Boy ismi ilk nerede duyuldu?", a:["Marineford","Fishman Island","Dressrosa","Alabasta"], c:1}, {q:"Luffyâ€™nin babasÄ± kimdir?", a:["Garp","Dragon","Roger","Shanks"], c:1}, {q:"Straw Hatâ€™lerin gemisinin adÄ± nedir?", a:["Going Merry","Thousand Sunny","Red Force","Moby Dick"], c:1} ];
        let quizQ=[], qIdx=0;
        
        function initQuiz(){ 
            quizQ = [...allQ].sort(()=>0.5-Math.random()).slice(0,10); 
            qIdx=0; 
            loadQ(); 
        }
        
        function loadQ(){ 
            if(qIdx>=quizQ.length){ 
                document.getElementById('quiz-box').innerHTML=`<p>Bitti! (+Ã–dÃ¼l eklendi)</p><button class='quiz-btn' onclick='location.reload()'>Tekrar</button>`; 
                return; 
            } 
            const q = quizQ[qIdx]; 
            document.getElementById('question-text').textContent = (qIdx+1)+". "+q.q; 
            document.querySelectorAll('.quiz-btn').forEach((b,i)=>{ 
                b.textContent=q.a[i]; 
                b.disabled=false; 
                b.style.background="var(--bg-dark)"; 
            }); 
        }
        
        // Bu fonksiyon Firebase script'i ile haberleÅŸecek
        window.checkAnswer = function(i){ 
            if(i===quizQ[qIdx].c){ 
                document.getElementById('feedback-text').textContent="DoÄŸru! (+5000)";
                // EÄŸer Firebase yÃ¼klendiyse ve kullanÄ±cÄ± giriÅŸ yaptÄ±ysa Ã¶dÃ¼lÃ¼ ver
                if(window.updateLocalBounty) window.updateLocalBounty(5000);
            } else { 
                document.getElementById('feedback-text').textContent="YanlÄ±ÅŸ!"; 
            } 
            qIdx++; 
            setTimeout(loadQ, 800); 
        }

        window.spinFruit = function() {
            // Basit kontrol, detaylÄ± kontrol Firebase tarafÄ±nda
            document.getElementById('fruit-display').style.transform = "rotate(1080deg)";
            setTimeout(() => {
                const fruitList = [{n:"Hito Hito: Nika", v:3000000000, c:0.01}, {n:"Gura Gura", v:1500000000, c:0.03}, {n:"Ope Ope", v:1000000000, c:0.05}, {n:"Mera Mera", v:500000000, c:0.10}, {n:"Gomu Gomu", v:100000000, c:0.20}, {n:"Bara Bara", v:15000000, c:0.30}, {n:"Sube Sube", v:5000000, c:0.31}];
                let rand = Math.random(), cumulative = 0, selected = fruitList[fruitList.length-1];
                for(let f of fruitList) { cumulative += f.c; if(rand <= cumulative) { selected = f; break; } }
                
                document.getElementById('fruit-display').innerHTML = `<div class="fruit-name">${selected.n}</div><div class="fruit-desc">+${selected.v.toLocaleString()}</div>`;
                document.getElementById('fruit-display').style.transform = "rotate(0deg)";
                
                // EÄŸer Firebase yÃ¼klendiyse iÅŸlemi kaydet
                if(window.processSpinResult) window.processSpinResult(selected);
                else alert("GiriÅŸ yapmadÄ±ÄŸÄ±n iÃ§in sonuÃ§ kaydedilmedi!");
            }, 1000);
        }

        const contents = {
            'manga': `<h2>ğŸš¨ Ã–nemliler (En SÄ±cak GeliÅŸmeler)</h2><h3>1. Manga: BÃ¶lÃ¼m 1174 ve "BÃ¼yÃ¼k Mola"</h3><p><strong>GÃ¼ncel Durum:</strong> Manga ÅŸu an Elbaf ArkÄ±'nÄ±n zirvesinde. Ä°nternetteki son raporlara gÃ¶re 1174. BÃ¶lÃ¼m'Ã¼n yarÄ±n (15 Åubat 2026) yayÄ±nlanmasÄ± bekleniyor.</p><p><strong>KÃ¶tÃ¼ Haber (Ara):</strong> 1174. bÃ¶lÃ¼mden sonra Eiichiro Oda'nÄ±n klasik "3 bÃ¶lÃ¼m Ã§iz, 1 hafta ara ver" rutini devreye girecek. Yani 22 Åubat haftasÄ± manga yok.</p><p><strong>DÃ¶nÃ¼ÅŸ:</strong> Seri, 1 Mart 2026'da 1175. BÃ¶lÃ¼m ile geri dÃ¶necek.</p><p><strong>BÃ¼yÃ¼k Olay (Spoiler Ä°Ã§erebilir):</strong> Ä°nternetteki sÄ±zÄ±ntÄ±lar ve tartÄ±ÅŸmalar, 1175. bÃ¶lÃ¼mÃ¼n serinin en bÃ¼yÃ¼k savaÅŸlarÄ±ndan birine, Luffy vs. Imu karÅŸÄ±laÅŸmasÄ±na sahne olacaÄŸÄ±nÄ± (veya bu savaÅŸÄ±n kÄ±zÄ±ÅŸacaÄŸÄ±nÄ±) iÅŸaret ediyor.</p><h3>2. Live Action (2. Sezon): Tarih KesinleÅŸti!</h3><p><strong>YayÄ±n Tarihi:</strong> Netflix, One Piece Live Action 2. Sezon'un 10 Mart 2026'da yayÄ±nlanacaÄŸÄ±nÄ± doÄŸruladÄ±. Yani 1 aydan az bir sÃ¼re kaldÄ±.</p><p><strong>Kapsam:</strong> Bu sezon Loguetown ile baÅŸlayÄ±p, Drum AdasÄ±'na kadar gidecek (Alabasta muhtemelen 3. sezona saklandÄ±).</p><p><strong>3. Sezon OnayÄ±:</strong> Åimdiden 3. sezon onayÄ± alÄ±ndÄ±ÄŸÄ± ve Ã§ekimlerin (Ã¶zellikle Alabasta kÄ±sÄ±mlarÄ± iÃ§in) baÅŸladÄ±ÄŸÄ±na dair gÃ¼Ã§lÃ¼ haberler var.</p><p><strong>Kadro:</strong> Smoker (Callum Kerr) ve Tashigi (Julia Rehwald) gibi karakterler fragmanlarda gÃ¶rÃ¼ndÃ¼. Tony Tony Chopper'Ä±n CGI/Makyaj karÄ±ÅŸÄ±mÄ± gÃ¶rÃ¼nÃ¼mÃ¼ bÃ¼yÃ¼k merak konusu.</p><h3>ğŸ”¥ Ã–ne Ã‡Ä±kanlar (Detaylar & Yan Projeler)</h3><p><strong>1. Anime (Wit Studio Remake): Sessizlik SÃ¼rÃ¼yor</strong><br>Netflix ve Wit Studio'nun (Attack on Titan'Ä±n ilk stÃ¼dyosu) hazÄ±rladÄ±ÄŸÄ± "THE ONE PIECE" yeniden yapÄ±mÄ± (remake) iÃ§in Jump Festa 2026'da beklenen fragman gelmedi. Proje "yapÄ±m aÅŸamasÄ±nda" denilerek geÃ§iÅŸtirildi. Ä°nternetteki genel kanÄ±, projenin beklenenden yavaÅŸ ilerlediÄŸi yÃ¶nÃ¼nde.</p><p><strong>2. Mevcut Anime (Toei Animation)</strong><br>Orijinal anime serisi de manga ile paralel olarak Elbaf dÃ¶nemine giriÅŸ yapmÄ±ÅŸ durumda (veya Egghead'in finalini iÅŸliyor, takvime gÃ¶re deÄŸiÅŸebilir). Ancak manga ÅŸu an Ã§ok kritik bir savaÅŸta olduÄŸu iÃ§in tÃ¼m gÃ¶zler okuyucularda.</p><h3>ğŸ”® Hayranlara GÃ¶re Ã–nÃ¼mÃ¼zdeki BÃ¶lÃ¼mler & Teoriler</h3><p><strong>Luffy vs. Imu (BÃ¶lÃ¼m 1175+):</strong><br>Hayranlar, 1 Mart'ta gelecek 1175. bÃ¶lÃ¼mÃ¼n, Luffy'nin "GÃ¼neÅŸ TanrÄ±sÄ± Nika" formu ile Imu arasÄ±ndaki doÄŸrudan Ã§atÄ±ÅŸmanÄ±n baÅŸlangÄ±cÄ± olacaÄŸÄ±na inanÄ±yor. Bu, serinin finaline giden en net yol olarak gÃ¶rÃ¼lÃ¼yor. Bir diÄŸer teori, Elbaf'taki Devlerin bu savaÅŸta Luffy'ye nasÄ±l bir ordu desteÄŸi vereceÄŸi Ã¼zerine.</p><p><strong>Shanks'Ä±n Hamlesi:</strong><br>Elbaf, Shanks'Ä±n bÃ¶lgesi olduÄŸu iÃ§in, hayranlar Shanks'Ä±n Luffy ile Imu arasÄ±ndaki savaÅŸa mÃ¼dahil olmasÄ±nÄ± veya "One Piece"i almak iÃ§in son hamlesini yapmasÄ±nÄ± bekliyor. "Davy Back Fight" teorileri veya "Son Poneglyph"in konumu hakkÄ±nda spekÃ¼lasyonlar zirvede.</p><p><strong>Live Action Chopper:</strong><br>10 Mart'taki prÃ¶miyer Ã¶ncesi en bÃ¼yÃ¼k korku ve merak Chopper. Dedektif Pikachu tarzÄ± gerÃ§ekÃ§i bir yaklaÅŸÄ±m mÄ± yoksa daha maskotvari bir yaklaÅŸÄ±m mÄ± olduÄŸu hala en Ã§ok tartÄ±ÅŸÄ±lan konu.</p>`,
            'sbs': `<h2>SBS (Soru-Cevap KÃ¶ÅŸesi)</h2><p>Bu SBS'ler genellikle karakterlerin kiÅŸisel Ã¶zelliklerini tanÄ±mlar ve hayranlar arasÄ±nda "canon" (resmi) bilgi kabul edilir.</p><h3>EÄŸer HasÄ±r Åapkalar GerÃ§ek DÃ¼nyada YaÅŸasaydÄ± (Cilt 56)</h3><p><strong>Okuyucu (D):</strong> Oda-sensei! Luffy ve diÄŸerleri gerÃ§ek hayatta olsalardÄ± hangi Ã¼lkeden olurlardÄ±?</p><p><strong>Oda (O):</strong> Karakterlerin gÃ¶rÃ¼nÃ¼ÅŸlerine ve imajlarÄ±na dayanarak ÅŸÃ¶yle olurdu:<br>Luffy: Brezilya<br>Zoro: Japonya<br>Nami: Ä°sveÃ§<br>Usopp: Afrika (KÄ±ta olarak belirtmiÅŸ)<br>Sanji: Fransa<br>Chopper: Kanada<br>Robin: Rusya<br>Franky: ABD<br>Brook: Avusturya<br>(Not: Jinbe daha sonra eklendiÄŸinde onun iÃ§in "Hindistan" demiÅŸtir.)</p><h3>Banyo Yapma SÄ±klÄ±klarÄ± (Cilt 48)</h3><p><strong>D:</strong> Merak ediyorum, HasÄ±r Åapka KorsanlarÄ± ne sÄ±klÄ±kla banyo yapÄ±yor?</p><p><strong>O:</strong> Bu soru Ã§ok geliyor. Ä°ÅŸte cevaplar:<br>Luffy, Zoro, Brook: Haftada 1 kez.<br>Usopp, Franky, Chopper: 3 gÃ¼nde 1 kez.<br>Sanji, Nami, Robin: Her gÃ¼n.<br><strong>Oda'nÄ±n notu:</strong> Sanji her gÃ¼n yÄ±kanÄ±r Ã§Ã¼nkÃ¼ kadÄ±nlarÄ±n yanÄ±na temiz gitmek ister. Erkeklerin olduÄŸu gÃ¼nler "erkekler gÃ¼nÃ¼" gibi toplu yÄ±kanÄ±rlar ve tam bir kaos ortamÄ± olur. Chopper genelde kadÄ±nlarla yÄ±kanÄ±r Ã§Ã¼nkÃ¼ erkekler Ã§ok vahÅŸi davranÄ±r.</p><h3>âš”ï¸ Karakter DetaylarÄ± ve SÄ±rlar</h3><p><strong>Zoro'nun KÄ±lÄ±Ã§larÄ±nÄ± AÄŸzÄ±yla TutmasÄ± (Cilt 5)</strong><br>D: Zoro konuÅŸurken kÄ±lÄ±cÄ± aÄŸzÄ±nda tutuyor. DiÅŸleri aÄŸrÄ±mÄ±yor mu? NasÄ±l konuÅŸabiliyor?<br>O: O, kalbiyle konuÅŸuyor! (Åaka bir yana, bu bir manga, Ã§ok takÄ±lmayÄ±n ama evet, Ã§enesi Ã§ok gÃ¼Ã§lÃ¼.)</p><p><strong>Sanji'nin KaÅŸlarÄ± (Cilt 7)</strong><br>D: Sanji'nin kaÅŸÄ± neden kÄ±vrÄ±k?<br>O: Hey! Dur orada! O kaÅŸ hakkÄ±nda ÅŸaka yapma! O kaÅŸÄ±n kÄ±vrÄ±mÄ±, evrenin enerjisini iÃ§inde barÄ±ndÄ±rÄ±r. EÄŸer o kÄ±vrÄ±m dÃ¼zleÅŸirse dÃ¼nya yok olabilir... Åaka ÅŸaka. Sadece tasarÄ±mÄ± hoÅŸuma gidiyor.</p><p><strong>Nami'nin KÄ±yafetleri (Cilt 20 civarÄ±)</strong><br>D: Nami neden hep bu kadar aÃ§Ä±k giyiniyor?<br>O: Ã‡Ã¼nkÃ¼ modayÄ± seviyor! AyrÄ±ca... Ã‡izmesi daha eÄŸlenceli deÄŸil mi? (Oda'nÄ±n klasik sapÄ±k ÅŸakalarÄ±).</p><h3>ğŸ Åeytan Meyveleri HakkÄ±nda</h3><p><strong>Ä°nsan Ä°nsan Meyvesi (Hito Hito no Mi) (Cilt 20)</strong><br>D: Chopper "Hito Hito no Mi" yedi ve insan-geyik oldu. Peki ya bir insan bu meyveyi yerse ne olur?<br>O: SanÄ±rÄ±m "AydÄ±nlanmÄ±ÅŸ Ä°nsan" olurdu. Nirvana'ya ulaÅŸmÄ±ÅŸ, kendini bulmuÅŸ bir insan... Ya da sadece yÃ¼zmesi imkansÄ±z hale gelen normal bir insan. (Oda burada Luffy'nin meyvesiyle ilgili gerÃ§eÄŸi yÄ±llar Ã¶ncesinden saklÄ±yordu).</p><p><strong>Luffy'nin UzamasÄ± (Ã‡eÅŸitli Ciltler)</strong><br>D: Luffy'nin vÃ¼cudu lastik olduÄŸu iÃ§in... Åeyi de uzuyor mu?<br>O: Evet. (Net ve kÄ±sa cevap).</p><h3>ğŸ‘´ Karakterlerin Gelecekteki Halleri</h3><p>Oda, son zamanlarda SBS'lerde karakterlerin "Ä°ÅŸler yolunda giderse" ve "Ä°ÅŸler kÃ¶tÃ¼ giderse" 40 ve 60 yaÅŸÄ±ndaki hallerini Ã§iziyor.</p><p><strong>Luffy'nin GeleceÄŸi (Cilt 89)</strong><br>40 YaÅŸ (Ä°yi Yol): "Et!! Yine mi et yiyoruz? Åahane!" (Shanks'a benziyor).<br>60 YaÅŸ (Ä°yi Yol): "Korsanlar KralÄ± mÄ±? Evet, o benim." (Garp'a benziyor).<br>40 YaÅŸ (KÃ¶tÃ¼ Yol): "Korsanlar KralÄ± mÄ±? RÃ¼ya gÃ¶rmeyi bÄ±rak." (ÅiÅŸman ve bakÄ±msÄ±z).<br>60 YaÅŸ (KÃ¶tÃ¼ Yol): "Hey, bana biraz et versene, borÃ§ yaz." (DiÅŸleri dÃ¶kÃ¼lmÃ¼ÅŸ).</p><p><strong>Ace'in GeleceÄŸi (EÄŸer Ã¶lmeseydi - Cilt 89)</strong><br>O: EÄŸer hayatta kalsaydÄ± bÃ¶yle gÃ¶rÃ¼nÃ¼rdÃ¼... (Oda burada Ace'in yaÅŸlanmÄ±ÅŸ, olgun ve BeyazbÄ±yÄ±k'a sadÄ±k, gÃ¼Ã§lÃ¼ bir korsan halini Ã§izdi. HayranlarÄ± aÄŸlatan bir SBS'dir.)</p><h3>ğŸ¤ª Komik ve Meta Sorular</h3><p><strong>BeyazbÄ±yÄ±k'Ä±n BÄ±yÄ±ÄŸÄ± mÄ± Yoksa... (Cilt 39)</strong><br>D: BeyazbÄ±yÄ±k'Ä±n (Whitebeard) yÃ¼zÃ¼ndeki o ÅŸey... O bir bÄ±yÄ±k mÄ± yoksa burnundan Ã§Ä±kan kÄ±llar mÄ±?<br>O: Ne kadar kaba! O ÅŸanlÄ± bir bÄ±yÄ±k! AslÄ±nda o bir bumerang! SavaÅŸta yerinden Ã§Ä±karÄ±p fÄ±rlatÄ±yor ve geri dÃ¶nÃ¼p tekrar yapÄ±ÅŸÄ±yor! (Tabii ki yalan sÃ¶ylÃ¼yor).</p><p><strong>Karakterlerin Beyin YapÄ±sÄ± (Cilt 50 civarÄ±)</strong><br>D: HasÄ±r ÅapkalarÄ±n beyninin iÃ§inde ne var?<br>O:<br>Luffy: Et, Et, Et, Et, Korsanlar KralÄ±.<br>Zoro: KÄ±lÄ±Ã§, KÄ±lÄ±Ã§, GÃ¼Ã§, Uyku, Sake.<br>Nami: Para, Para, Para, GÃ¼zellik, Para.<br>Sanji: KadÄ±nlar, Yemek, KadÄ±nlar, Nami-san, Robin-chan.<br>Chopper: Doktorluk, Ä°laÃ§, TatlÄ±, Pamuk Åeker.</p><h3>ğŸ—¡ï¸ Nesnelerin Ä°nsanlaÅŸtÄ±rÄ±lmasÄ±</h3><p><strong>Zoro'nun KÄ±lÄ±Ã§larÄ± Ä°nsan OlsaydÄ± (Cilt 92)</strong><br>D: Zoro'nun kÄ±lÄ±Ã§larÄ± (Wado Ichimonji, Sandai Kitetsu, Shusui) insan olsaydÄ± nasÄ±l gÃ¶rÃ¼nÃ¼rdÃ¼?<br>O:<br>Wado Ichimonji: Ciddi, geleneksel kÄ±yafetli, onurlu bir adam.<br>Sandai Kitetsu: SapkÄ±n, korkunÃ§ gÃ¶rÃ¼nÃ¼mlÃ¼, lanetli bir serseri.<br>Shusui: SavaÅŸÃ§Ä± ruhlu, gÃ¼Ã§lÃ¼ ama biraz kaba bir samuray.</p><h3>â“ SBS NasÄ±l BaÅŸlar ve Biter?</h3><p>SBS'nin en bÃ¼yÃ¼k kuralÄ±, okuyucunun kÃ¶ÅŸeyi baÅŸlatmaya Ã§alÄ±ÅŸmasÄ± ve Oda'nÄ±n bunu engellemeye Ã§alÄ±ÅŸmasÄ±dÄ±r (veya tam tersi).<br>Ã–rnek (Neredeyse her cilt):<br>D: "SBS BaÅŸlÄ±y..."<br>O: "BAÅLAMIYOR!"<br>Ã–rnek (Cilt 4):<br>D: "LÃ¼tfen SBS'yi baÅŸlatmama izin verin."<br>O: "Pekala, baÅŸlayÄ±n."<br>D: "SBS BAÅLADI!"<br>O: "Hah! Ben baÅŸlatacaktÄ±m!"</p>`,
            'anime': `<h2>Anime & Remake GÃ¼ncellemesi</h2><p><strong>Mevcut Anime (Toei Animation):</strong> Orijinal anime serisi de manga ile paralel olarak Elbaf dÃ¶nemine giriÅŸ yapmÄ±ÅŸ durumda. Ancak manga ÅŸu an Ã§ok kritik bir savaÅŸta olduÄŸu iÃ§in tÃ¼m gÃ¶zler okuyucularda.</p><p><strong>Wit Studio Remake:</strong> Sessizlik sÃ¼rÃ¼yor. Jump Festa 2026'da beklenen fragman gelmedi. Proje "yapÄ±m aÅŸamasÄ±nda" denilerek geÃ§iÅŸtirildi. Ä°nternetteki genel kanÄ±, projenin beklenenden yavaÅŸ ilerlediÄŸi yÃ¶nÃ¼nde.</p>`
        };

        window.openModal = function(key) { document.getElementById('modalBody').innerHTML = contents[key]; document.getElementById('infoModal').style.display='flex'; }
        window.closeModal = function(id) { document.getElementById(id || 'infoModal').style.display='none'; }
        window.openLoginModal = function() { document.getElementById('loginModal').style.display='flex'; }
        window.onclick = function(e) { if(e.target.classList.contains('modal-overlay')) e.target.style.display='none'; }

        // Anime SayacÄ± DÃ¼zeltildi
        setInterval(()=>{
            const now = new Date();
            const animeDate = new Date("2026-04-01");
            const diff = Math.ceil((animeDate - now) / (1000*60*60*24));
            document.getElementById('anime-timer').textContent = diff > 0 ? diff + " gÃ¼n" : "YayÄ±nda!";
            
            const mangaDate = new Date(); mangaDate.setDate(now.getDate() + (4 + 7 - now.getDay()) % 7);
            const d = Math.floor((mangaDate-now)/(1000*60*60*24));
            document.getElementById('manga-timer').textContent = d + " gÃ¼n";
            document.getElementById('la-timer').textContent = Math.ceil((new Date("2026-03-10") - now)/(1000*60*60*24)) + " gÃ¼n";
        }, 1000);

        // OYUNU BAÅLAT (Firebase'den baÄŸÄ±msÄ±z)
        initQuiz();
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, arrayUnion, arrayRemove, addDoc, onSnapshot, query, orderBy, limit, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // FIREBASE CONFIG (SENÄ°N ANAHTARLARIN)
        const firebaseConfig = {
            apiKey: "AIzaSyAYQ1FVg9YwQTb8kuWIfg9KHiUIHBbkpqY",
            authDomain: "one-piece-haber.firebaseapp.com",
            projectId: "one-piece-haber",
            storageBucket: "one-piece-haber.firebasestorage.app",
            messagingSenderId: "292653018558",
            appId: "1:292653018558:web:e275236747771db3329def",
            measurementId: "G-G4NTRHD0YH"
        };

        let db;
        try { const app = initializeApp(firebaseConfig); db = getFirestore(app); console.log("Firebase BaÄŸlandÄ±!"); } catch(e) { console.error("Firebase HatasÄ±:", e); }

        let currentUser = null;
        let uploadedImg = "https://static.wikia.nocookie.net/onepiece/images/c/c5/Revolutionary_Army_Jolly_Roger.png"; 
        let editImgTemp = "";

        // UI & HELPERS
        window.switchAuthMode = function(mode) {
            if(mode === 'login') { document.getElementById('login-form').style.display='block'; document.getElementById('register-form').style.display='none'; document.getElementById('btn-show-login').classList.add('active'); document.getElementById('btn-show-register').classList.remove('active'); } 
            else { document.getElementById('login-form').style.display='none'; document.getElementById('register-form').style.display='block'; document.getElementById('btn-show-login').classList.remove('active'); document.getElementById('btn-show-register').classList.add('active'); }
        }
        window.showTab = function(tabName) {
            document.querySelectorAll('.guild-tab-content').forEach(el => el.style.display='none');
            document.getElementById('tab-'+tabName).style.display='block';
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        window.previewImage = function() { const f = document.getElementById('reg-file').files[0]; if(f){ const r=new FileReader(); r.onload=()=>{ uploadedImg=r.result; document.getElementById('img-preview').src=uploadedImg; document.getElementById('img-preview').style.display="block"; }; r.readAsDataURL(f); } }
        window.previewEditImage = function() { const f = document.getElementById('edit-file').files[0]; if(f){ const r=new FileReader(); r.onload=()=>{ editImgTemp=r.result; document.getElementById('edit-preview').src=editImgTemp; }; r.readAsDataURL(f); } }

        // AUTH & SELF-REPAIR
        window.checkLogin = async function() {
            const saved = localStorage.getItem('op_user_v36'); // SÃ¼rÃ¼m V36 yapÄ±ldÄ±
            if(saved) {
                const temp = JSON.parse(saved);
                if(db) {
                    const snap = await getDoc(doc(db, "users", temp.name));
                    if(snap.exists()) { 
                        currentUser = snap.data(); 
                        let needsUpdate = false;
                        if(currentUser.guild === undefined) { currentUser.guild = ""; needsUpdate = true; }
                        if(currentUser.friends === undefined) { currentUser.friends = []; needsUpdate = true; }
                        if(currentUser.friendRequests === undefined) { currentUser.friendRequests = []; needsUpdate = true; }
                        if(needsUpdate) await updateUserData();
                        localStorage.setItem('op_user_v36', JSON.stringify(currentUser)); 
                    }
                }
                const today = new Date().toDateString();
                if (currentUser.lastSpinDate !== today) { currentUser.spinsLeft = 3; currentUser.lastSpinDate = today; updateUserData(); }
                document.getElementById('auth-section').innerHTML = `<div class="user-profile-mini" onclick="openProfile()"><img src="${currentUser.avatar}" class="user-avatar-small"><span>${currentUser.name}</span></div>`;
                document.getElementById('spin-count').textContent = currentUser.spinsLeft;
                listenLeaderboard(); listenChat(); listenGuilds(); listenPosts(); listenPoll();
            }
        }
        window.performRegister = async function() {
            if(!db) return alert("Hata!");
            const name = document.getElementById('reg-name').value.trim(); const pass = document.getElementById('reg-pass').value; const bio = document.getElementById('reg-bio').value;
            if(!name || !pass) return alert("Eksik bilgi!");
            const snap = await getDoc(doc(db, "users", name));
            if(snap.exists()) return alert("Ä°sim alÄ±nmÄ±ÅŸ!");
            currentUser = { name, pass, bio: bio||"Yeni Korsan", avatar: uploadedImg, bounty: 1000, fruit: "Meyvesiz", fruitVal: 0, spinsLeft: 3, lastSpinDate: new Date().toDateString(), friends: [], friendRequests: [], isActive: true, guild: "" };
            await setDoc(doc(db, "users", name), currentUser);
            localStorage.setItem('op_user_v36', JSON.stringify(currentUser)); location.reload();
        }
        window.performLogin = async function() {
            if(!db) return alert("Hata!");
            const name = document.getElementById('login-name').value.trim(); const pass = document.getElementById('login-pass').value;
            const snap = await getDoc(doc(db, "users", name));
            if(snap.exists() && snap.data().pass === pass) {
                currentUser = snap.data(); currentUser.isActive = true;
                if(!currentUser.friends) currentUser.friends=[]; if(!currentUser.friendRequests) currentUser.friendRequests=[]; if(!currentUser.guild) currentUser.guild="";
                await updateUserData(); localStorage.setItem('op_user_v36', JSON.stringify(currentUser)); location.reload();
            } else { alert("HatalÄ±!"); }
        }
        window.performLogout = function() { if(currentUser){ currentUser.isActive=false; updateUserData(); } localStorage.removeItem('op_user_v36'); location.reload(); }
        async function updateUserData() { if(!currentUser || !db) return; await setDoc(doc(db, "users", currentUser.name), currentUser); localStorage.setItem('op_user_v36', JSON.stringify(currentUser)); if(document.getElementById('current-score')) document.getElementById('current-score').textContent = currentUser.bounty.toLocaleString(); }
        
        async function updateGuildTotalBounty(gName) {
            if(!gName) return; const gRef = doc(db, "guilds", gName);
            try { await runTransaction(db, async (t) => { const gDoc = await t.get(gRef); if(!gDoc.exists()) return; const gData = gDoc.data(); let total = 0;
            for(const mName of gData.members) { const mDoc = await t.get(doc(db, "users", mName)); if(mDoc.exists()) total += mDoc.data().bounty; }
            t.update(gRef, { totalBounty: total }); }); } catch(e){console.error(e);}
        }

        // --- OYUN <-> FIREBASE KÃ–PRÃœSÃœ ---
        // Oyun script'i (yukarÄ±daki) bu fonksiyonlarÄ± Ã§aÄŸÄ±rarak puanÄ± kaydeder
        window.updateLocalBounty = async function(amount) {
            if(currentUser) {
                currentUser.bounty += amount;
                await updateUserData();
                if(currentUser.guild) await updateGuildTotalBounty(currentUser.guild);
            }
        }
        window.processSpinResult = async function(selected) {
            if(currentUser) {
                if(currentUser.fruitVal > 0) currentUser.bounty -= currentUser.fruitVal;
                currentUser.fruit = selected.n; currentUser.fruitVal = selected.v; currentUser.bounty += selected.v; if(currentUser.bounty < 0) currentUser.bounty = 0;
                await updateUserData(); 
                if(currentUser.guild) await updateGuildTotalBounty(currentUser.guild);
                document.getElementById('spin-count').textContent = currentUser.spinsLeft;
            }
        }

        // PROFÄ°L & ARKADAÅLIK
        window.openProfile = function() {
            if(!currentUser) return;
            document.getElementById('profile-name').textContent = currentUser.name; document.getElementById('profile-img').src = currentUser.avatar;
            document.getElementById('profile-bounty').textContent = currentUser.bounty.toLocaleString(); document.getElementById('profile-bio').textContent = currentUser.bio;
            const fb = document.getElementById('profile-fruit');
            if(currentUser.fruit && currentUser.fruit !== "Meyvesiz") { fb.textContent = "Meyve: " + currentUser.fruit; fb.style.display="inline-block"; } else { fb.style.display="none"; }
            
            if(currentUser.guild) { document.getElementById('guild-status-area').style.display="none"; document.getElementById('my-guild-info').style.display="block"; loadGuildInfo(currentUser.guild); }
            else { document.getElementById('guild-status-area').style.display="block"; document.getElementById('my-guild-info').style.display="none"; }
            renderFriendsAndRequests();
            document.getElementById('profileModal').style.display='flex';
        }
        window.enableEdit = function() { document.getElementById('edit-bio').value = currentUser.bio; document.getElementById('edit-preview').src = currentUser.avatar; editImgTemp = currentUser.avatar; closeModal('profileModal'); document.getElementById('editProfileModal').style.display = 'flex'; }
        window.saveProfileEdit = async function() { currentUser.bio = document.getElementById('edit-bio').value; currentUser.avatar = editImgTemp; await updateUserData(); alert("Kaydedildi!"); closeModal('editProfileModal'); openProfile(); }
        window.sendFriendRequest = async function() {
            const t = document.getElementById('friend-input').value.trim();
            if(!t || t===currentUser.name || (currentUser.friends && currentUser.friends.includes(t))) return alert("GeÃ§ersiz!");
            const snap = await getDoc(doc(db, "users", t));
            if(!snap.exists()) return alert("BÃ¶yle bir korsan yok!");
            const tData = snap.data(); if(tData.friendRequests && tData.friendRequests.includes(currentUser.name)) return alert("Ä°stek zaten var!");
            await updateDoc(doc(db, "users", t), { friendRequests: arrayUnion(currentUser.name) }); alert("YollandÄ±!"); document.getElementById('friend-input').value="";
        }
        async function renderFriendsAndRequests() {
            const snap = await getDoc(doc(db, "users", currentUser.name)); currentUser = snap.data();
            const rl = document.getElementById('request-ul');
            if(!currentUser.friendRequests || !currentUser.friendRequests.length) rl.innerHTML="<li>Ä°stek yok.</li>";
            else rl.innerHTML = currentUser.friendRequests.map(r=>`<li>${r} <div class="friend-actions"><button class="btn-tiny btn-accept" onclick="acceptRequest('${r}')">âœ“</button><button class="btn-tiny btn-decline" onclick="declineRequest('${r}')">âœ—</button></div></li>`).join('');
            const fl = document.getElementById('friend-ul');
            if(!currentUser.friends || !currentUser.friends.length) fl.innerHTML="<li>Kimse yok...</li>";
            else fl.innerHTML = currentUser.friends.map(f=>`<li><span onclick="viewFriendProfile('${f}')" style="flex-grow:1;cursor:pointer;">â˜ ï¸ ${f}</span><button class="btn-tiny btn-remove" onclick="removeFriend('${f}')">ğŸ—‘ï¸</button></li>`).join('');
        }
        window.acceptRequest = async function(r) { await updateDoc(doc(db, "users", currentUser.name), { friendRequests: arrayRemove(r), friends: arrayUnion(r) }); await updateDoc(doc(db, "users", r), { friends: arrayUnion(currentUser.name) }); alert("Dost oldunuz!"); renderFriendsAndRequests(); }
        window.declineRequest = async function(r) { await updateDoc(doc(db, "users", currentUser.name), { friendRequests: arrayRemove(r) }); renderFriendsAndRequests(); }
        window.removeFriend = async function(f) { if(confirm("Silinsin mi?")){ await updateDoc(doc(db, "users", currentUser.name), { friends: arrayRemove(f) }); await updateDoc(doc(db, "users", f), { friends: arrayRemove(currentUser.name) }); renderFriendsAndRequests(); } }
        window.viewFriendProfile = async function(n) {
            const snap = await getDoc(doc(db, "users", n));
            if(snap.exists()) { const u = snap.data(); document.getElementById('view-name').textContent = u.name; document.getElementById('view-img').src = u.avatar; document.getElementById('view-bounty').textContent = u.bounty.toLocaleString(); document.getElementById('view-bio').textContent = u.bio; const vf = document.getElementById('view-fruit'); if(u.fruit && u.fruit!=="Meyvesiz") { vf.textContent=u.fruit; vf.style.display="inline-block"; } else { vf.style.display="none"; } document.getElementById('view-status').textContent = u.isActive ? "ğŸŸ¢ Aktif" : "ğŸ”´ Pasif"; closeModal('profileModal'); document.getElementById('viewFriendModal').style.display='flex'; }
        }

        // --- GUILDS ---
        window.createGuild = async function() {
            const gName = document.getElementById('guild-create-input').value.trim();
            const gDesc = document.getElementById('guild-desc-input').value.trim();
            const gFile = document.getElementById('guild-flag-input').files[0];
            if(!gName) return alert("Ä°sim lazÄ±m!");
            let flagBase64 = "https://static.wikia.nocookie.net/onepiece/images/a/a2/Straw_Hat_Pirates_Jolly_Roger.png"; 
            if(gFile) { const reader = new FileReader(); reader.readAsDataURL(gFile); await new Promise(resolve => reader.onload = () => { flagBase64 = reader.result; resolve(); }); }
            const snap = await getDoc(doc(db, "guilds", gName));
            if(snap.exists()) return alert("Bu isimde ittifak var!");
            const roles = {}; roles[currentUser.name] = "Kaptan";
            await setDoc(doc(db, "guilds", gName), { name: gName, desc: gDesc, flag: flagBase64, captain: currentUser.name, roles: roles, members: [currentUser.name], totalBounty: currentUser.bounty });
            currentUser.guild = gName; await updateUserData(); alert("Ä°ttifak kuruldu!"); openProfile();
        }
        window.joinGuild = async function() {
            const gName = document.getElementById('guild-join-input').value.trim();
            if(!gName) return;
            const gRef = doc(db, "guilds", gName);
            const snap = await getDoc(gRef);
            if(!snap.exists()) return alert("BulunamadÄ±!");
            const gData = snap.data(); if(!gData.roles) gData.roles = {}; gData.roles[currentUser.name] = "Tayfa";
            await updateDoc(gRef, { members: arrayUnion(currentUser.name), roles: gData.roles });
            currentUser.guild = gName; await updateUserData(); await updateGuildTotalBounty(gName); alert("KatÄ±ldÄ±n!"); openProfile();
        }
        window.leaveGuild = async function() {
            if(!currentUser.guild) return;
            const gName = currentUser.guild; const gRef = doc(db, "guilds", gName);
            const snap = await getDoc(gRef);
            if(snap.exists()) {
                const gData = snap.data();
                if(gData.captain === currentUser.name && gData.members.length > 1) return alert("Kaptan ayrÄ±lamaz! Ã–nce devret veya tek kal.");
                const newRoles = {...gData.roles}; delete newRoles[currentUser.name];
                await updateDoc(gRef, { members: arrayRemove(currentUser.name), roles: newRoles });
            }
            currentUser.guild = ""; await updateUserData(); await updateGuildTotalBounty(gName); alert("AyrÄ±ldÄ±n!"); openProfile();
        }
        window.promoteMember = async function(mName) {
            const gRef = doc(db, "guilds", currentUser.guild); const snap = await getDoc(gRef); const gData = snap.data();
            const currentRole = gData.roles[mName]; let newRole = "";
            if(currentRole === "Tayfa") newRole = "KÄ±demli"; else if(currentRole === "KÄ±demli") newRole = "Sol Kol"; else if(currentRole === "Sol Kol") newRole = "SaÄŸ Kol"; else return alert("Zirve!");
            gData.roles[mName] = newRole; await updateDoc(gRef, { roles: gData.roles }); openProfile();
        }
        window.demoteMember = async function(mName) {
            const gRef = doc(db, "guilds", currentUser.guild); const snap = await getDoc(gRef); const gData = snap.data();
            const currentRole = gData.roles[mName]; let newRole = "";
            if(currentRole === "SaÄŸ Kol") newRole = "Sol Kol"; else if(currentRole === "Sol Kol") newRole = "KÄ±demli"; else if(currentRole === "KÄ±demli") newRole = "Tayfa"; else return;
            gData.roles[mName] = newRole; await updateDoc(gRef, { roles: gData.roles }); openProfile();
        }
        window.kickMember = async function(mName) {
            if(!confirm(mName + " atÄ±lsÄ±n mÄ±?")) return;
            const gRef = doc(db, "guilds", currentUser.guild); const snap = await getDoc(gRef); const gData = snap.data();
            const newRoles = {...gData.roles}; delete newRoles[mName];
            await updateDoc(gRef, { members: arrayRemove(mName), roles: newRoles });
            const uRef = doc(db, "users", mName); await updateDoc(uRef, { guild: "" });
            await updateGuildTotalBounty(currentUser.guild); openProfile();
        }
        async function loadGuildInfo(gName) {
            const snap = await getDoc(doc(db, "guilds", gName));
            if(snap.exists()) {
                const g = snap.data(); await updateGuildTotalBounty(gName);
                document.getElementById('g-name').textContent = g.name; document.getElementById('g-desc').textContent = g.desc || ""; document.getElementById('g-flag-display').src = g.flag; document.getElementById('g-captain').textContent = g.captain; document.getElementById('g-bounty').textContent = g.totalBounty.toLocaleString();
                const ul = document.getElementById('g-members'); ul.innerHTML = "";
                const roleClass = { "Kaptan": "role-captain", "SaÄŸ Kol": "role-righthand", "Sol Kol": "role-lefthand", "KÄ±demli": "role-senior", "Tayfa": "role-member" };
                const order = {"Kaptan":1, "SaÄŸ Kol":2, "Sol Kol":3, "KÄ±demli":4, "Tayfa":5};
                const safeRoles = g.roles || {};
                const sortedMembers = g.members.sort((a,b) => (order[safeRoles[a]] || 5) - (order[safeRoles[b]] || 5));
                for(const m of sortedMembers) {
                     const uSnap = await getDoc(doc(db, "users", m));
                     if(uSnap.exists()) {
                         const uData = uSnap.data(); const role = safeRoles[m] || "Tayfa"; let actions = "";
                         if(currentUser.name === g.captain && m !== currentUser.name) { actions = `<div style="display:inline-block; float:right;"><button class="btn-tiny" style="background:green" onclick="promoteMember('${m}')">â–²</button><button class="btn-tiny" style="background:orange" onclick="demoteMember('${m}')">â–¼</button><button class="btn-tiny" style="background:red" onclick="kickMember('${m}')">X</button></div>`; }
                         ul.innerHTML += `<li style="border-bottom:1px solid #ccc; padding:5px;"><span class="role-badge ${roleClass[role] || 'role-member'}">${role}</span> <b>${m}</b> (${uData.bounty.toLocaleString()}) ${actions}</li>`;
                     }
                }
            }
        }
        function listenGuilds() { const q = query(collection(db, "guilds"), orderBy("totalBounty", "desc"), limit(10)); onSnapshot(q, (snap) => { const tb = document.getElementById('guild-leaderboard'); tb.innerHTML = ""; let i = 1; snap.forEach(d => { const g = d.data(); tb.innerHTML += `<tr><td>${i++}</td><td><img src="${g.flag}" class="guild-flag"></td><td>${g.name}</td><td>${(g.totalBounty || 0).toLocaleString()} à¸¿</td></tr>`; }); }); }

        // --- TEORÄ° DUVARI & ANKET ---
        window.createPost = async function() {
            if(!currentUser) return alert("GiriÅŸ yap!");
            const title = document.getElementById('post-title').value.trim(); const content = document.getElementById('post-content').value.trim();
            if(!title || !content) return alert("BoÅŸ bÄ±rakma!");
            await addDoc(collection(db, "posts"), { title, content, author: currentUser.name, time: serverTimestamp(), likes: [] });
            document.getElementById('post-title').value=""; document.getElementById('post-content').value=""; alert("PaylaÅŸÄ±ldÄ±!");
        }
        function listenPosts() {
            const q = query(collection(db, "posts"), orderBy("time", "desc"), limit(20));
            onSnapshot(q, (snap) => {
                const feed = document.getElementById('posts-feed'); feed.innerHTML = "";
                snap.forEach(d => {
                    const p = d.data(); const pid = d.id; const likeCount = p.likes ? p.likes.length : 0;
                    feed.innerHTML += `<div class="post-card"><div class="post-header"><span class="post-author">@${p.author}</span><span class="post-time">Yeni</span></div><h4 class="post-title">${p.title}</h4><p class="post-body">${p.content}</p><div class="post-actions"><button class="btn-respect" onclick="likePost('${pid}')">Respect (+${likeCount})</button></div></div>`;
                });
            });
        }
        window.likePost = async function(pid) {
            if(!currentUser) return; const pRef = doc(db, "posts", pid);
            await runTransaction(db, async (t) => {
                const pDoc = await t.get(pRef); if(!pDoc.exists()) return; const pData = pDoc.data();
                if(pData.likes && pData.likes.includes(currentUser.name)) return alert("Zaten beÄŸendin!");
                t.update(pRef, { likes: arrayUnion(currentUser.name) });
                const authorRef = doc(db, "users", pData.author); t.update(authorRef, { bounty: (await t.get(authorRef)).data().bounty + 100000 });
            });
        }

        const pollOptions = ["Luffy", "Blackbeard", "Shanks", "Buggy"];
        const pollId = "poll_v1";
        
        async function initPoll() { listenPoll(); }
        function listenPoll() {
            const pollRef = doc(db, "polls", pollId);
            onSnapshot(pollRef, (doc) => {
                if(!doc.exists()) { setDoc(pollRef, { votes: {Luffy:0, Blackbeard:0, Shanks:0, Buggy:0}, voters: [] }); return; }
                const data = doc.data(); const total = Object.values(data.votes).reduce((a,b)=>a+b, 0);
                const container = document.getElementById('poll-options-container'); container.innerHTML = "";
                pollOptions.forEach(opt => {
                    const count = data.votes[opt] || 0; const pct = total > 0 ? Math.round((count/total)*100) : 0;
                    container.innerHTML += `<div class="poll-option" onclick="votePoll('${opt}')"><div class="poll-bar" style="width:${pct}%"></div><div class="poll-text"><span>${opt}</span><span>%${pct} (${count})</span></div></div>`;
                });
            });
        }
        window.votePoll = async function(opt) {
            if(!currentUser) return alert("GiriÅŸ yap!");
            const pollRef = doc(db, "polls", pollId);
            await runTransaction(db, async (t) => {
                const pDoc = await t.get(pollRef); const pData = pDoc.data();
                if(pData.voters && pData.voters.includes(currentUser.name)) return alert("Zaten oy verdin!");
                const newVotes = pData.votes; newVotes[opt]++;
                t.update(pollRef, { votes: newVotes, voters: arrayUnion(currentUser.name) });
            });
            alert("Oy kullanÄ±ldÄ±!");
        }

        function listenChat() { const q = query(collection(db, "chat"), orderBy("time", "asc"), limit(50)); onSnapshot(q, (snap) => { const box = document.getElementById('chat-box'); box.innerHTML = ""; snap.forEach(d => { const m = d.data(); const cls = m.user === currentUser.name ? "msg-me" : "msg-other"; box.innerHTML += `<div class="chat-msg ${cls}"><span class="msg-sender">${m.user}</span>${m.text}</div>`; }); box.scrollTop = box.scrollHeight; }); }
        window.sendMessage = async function() { const txt = document.getElementById('chat-input').value.trim(); if(!txt || !currentUser) return; await addDoc(collection(db, "chat"), { user: currentUser.name, text: txt, time: serverTimestamp() }); document.getElementById('chat-input').value = ""; }
        function listenLeaderboard() { if(!db) return; const q = query(collection(db, "users"), orderBy("bounty", "desc"), limit(50)); onSnapshot(q, (snapshot) => { const tbody = document.getElementById('leaderboard-body'); tbody.innerHTML = ""; let rank = 1; snapshot.forEach((doc) => { const u = doc.data(); const isMe = currentUser && currentUser.name === u.name ? 'current-user-row' : ''; tbody.innerHTML += `<tr class="${isMe}"><td>${rank++}</td><td>${u.name}</td><td>${u.bounty.toLocaleString()} à¸¿</td><td>${u.fruit || '-'}</td></tr>`; }); }); }
        
        checkLogin(); initPoll();
        listenLeaderboard(); listenChat(); listenGuilds(); listenPosts();
    </script>
</body>
</html>
