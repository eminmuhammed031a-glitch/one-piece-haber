<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="One Piece Haber - Yeni D√ºnya, Grand Line'ƒ±n en g√ºncel haber portalƒ±. Manga, anime, SBS ve teoriler.">
    <meta name="keywords" content="One Piece, Manga, Anime, Luffy, Zoro, Nami, Grand Line, Yeni D√ºnya">
    <title>One Piece Haber | Yeni D√ºnya - Grand Line'ƒ±n En B√ºy√ºk Haber Portalƒ±</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=Cinzel:wght@400;600;800&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    
    <!-- Tone.js for Sound Effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'luffy-red': '#d62828',
                        'luffy-dark': '#8b0000',
                        'ocean-blue': '#006994',
                        'ocean-deep': '#003d5c',
                        'treasure-gold': '#ffb703',
                        'gold-light': '#ffd700',
                        'parchment': '#f4e4bc',
                        'parchment-dark': '#e6d5a7',
                        'glass-white': 'rgba(255, 255, 255, 0.15)',
                        'glass-dark': 'rgba(0, 0, 0, 0.6)',
                    },
                    fontFamily: {
                        'pirata': ['"Pirata One"', 'cursive'],
                        'cinzel': ['"Cinzel"', 'serif'],
                        'roboto': ['"Roboto"', 'sans-serif'],
                    },
                    animation: {
                        'spin-slow': 'spin 4s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'slide-case': 'slideCase 5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
                            '50%': { transform: 'translateY(-20px) rotate(2deg)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(255, 183, 3, 0.5)' },
                            '50%': { boxShadow: '0 0 40px rgba(255, 183, 3, 0.8), 0 0 60px rgba(214, 40, 40, 0.4)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px) scale(0.95)' },
                            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                        },
                        glow: {
                            '0%': { filter: 'brightness(1) drop-shadow(0 0 5px rgba(255,183,3,0.5))' },
                            '100%': { filter: 'brightness(1.2) drop-shadow(0 0 20px rgba(255,183,3,0.8))' },
                        },
                        slideCase: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-200%)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Enhanced Glassmorphism */
        .glass-premium {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 183, 3, 0.3);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(214, 40, 40, 0.3),
                0 0 40px rgba(255, 183, 3, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 183, 3, 0.8);
        }

        /* Image Fallback System */
        .hero-luffy {
            background-image: 
                url('luffy3.jpg'), 
                url('https://images.unsplash.com/photo-1618336753974-aae8e04506aa?w=800&q=80'),
                linear-gradient(135deg, #d62828 0%, #8b0000 50%, #000000 100%);
            background-size: cover;
            background-position: center top;
        }
        
        .hero-zoro {
            background-image: 
                url('zoro.jpg'), 
                url('https://images.unsplash.com/photo-1578632767115-351597cf2477?w=800&q=80'),
                linear-gradient(135deg, #006400 0%, #003d00 50%, #000000 100%);
            background-size: cover;
            background-position: center top;
        }
        
        .hero-robin {
            background-image: 
                url('robin.jpg'), 
                url('https://images.unsplash.com/photo-1535701121395-c1a14c1e8c5e?w=800&q=80'),
                linear-gradient(135deg, #4B0082 0%, #2d0052 50%, #000000 100%);
            background-size: cover;
            background-position: center top;
        }
        
        .bg-aokiji {
            background-image: 
                url('aokiji.jpg'), 
                url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800&q=80'),
                linear-gradient(135deg, #4682B4 0%, #1e3d5c 50%, #000000 100%);
            background-size: cover;
            background-position: center;
        }
        
        .bg-xebec {
            background-image: 
                url('xebec.jpg'), 
                url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80'),
                linear-gradient(135deg, #2F4F4F 0%, #1a2f2f 50%, #000000 100%);
            background-size: cover;
            background-position: center;
        }

        /* Premium Typography */
        .title-epic {
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-shadow: 
                0 0 10px rgba(255, 183, 3, 0.5),
                0 0 20px rgba(214, 40, 40, 0.3),
                2px 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(135deg, #ffb703 0%, #fff 50%, #ffb703 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle-glow {
            text-shadow: 0 0 20px rgba(255, 183, 3, 0.6);
            letter-spacing: 0.1em;
        }

        /* Enhanced Shadows */
        .shadow-epic {
            box-shadow: 
                0 10px 40px -10px rgba(214, 40, 40, 0.5),
                0 0 20px rgba(255, 183, 3, 0.2);
        }
        
        .shadow-gold {
            box-shadow: 
                0 4px 20px rgba(255, 183, 3, 0.4),
                0 0 0 1px rgba(255, 183, 3, 0.3);
        }

        /* Button Effects */
        .btn-premium {
            background: linear-gradient(135deg, #d62828 0%, #8b0000 100%);
            border: 2px solid #ffb703;
            box-shadow: 
                0 4px 15px rgba(214, 40, 40, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .btn-premium:hover::before {
            left: 100%;
        }
        
        .btn-premium:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 8px 25px rgba(214, 40, 40, 0.6),
                0 0 30px rgba(255, 183, 3, 0.4);
        }

        .btn-gold {
            background: linear-gradient(135deg, #ffb703 0%, #cc8a00 100%);
            border: 2px solid #fff;
            box-shadow: 0 4px 15px rgba(255, 183, 3, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn-gold:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(255, 183, 3, 0.6),
                0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #d62828, #ffb703);
            border-radius: 6px;
            border: 3px solid #1a1a1a;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #ff4444, #ffd700);
        }

        /* Texture Overlay */
        .texture-parchment {
            background-color: #f4e4bc;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E"),
                linear-gradient(180deg, rgba(244,228,188,1) 0%, rgba(230,213,167,1) 100%);
        }

        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(135deg, #ffb703 0%, #fff 50%, #d62828 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Card Hover Glow */
        .card-glow {
            position: relative;
        }
        .card-glow::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, #d62828, #ffb703, #006994);
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .card-glow:hover::after {
            opacity: 1;
        }

        /* Case Opening Styles */
        .case-container {
            position: relative;
            height: 120px;
            overflow: hidden;
            background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 3px solid #ffb703;
            border-radius: 12px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        
        .case-strip {
            display: flex;
            gap: 10px;
            padding: 10px;
            position: absolute;
            left: 50%;
            transform: translateX(0);
        }
        
        .case-item {
            min-width: 100px;
            height: 100px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 2px solid;
            background: rgba(0,0,0,0.5);
        }
        
        .case-selector {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #ffb703;
            transform: translateX(-50%);
            z-index: 10;
            box-shadow: 0 0 10px #ffb703;
        }

        /* Idle Game Styles */
        .idle-btn {
            position: relative;
            overflow: hidden;
        }
        
        .idle-btn:active {
            transform: scale(0.95);
        }
        
        .power-bar {
            background: linear-gradient(90deg, #d62828, #ffb703);
            transition: width 0.3s ease;
        }

        /* Music Player */
        .music-player {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 40;
        }

        /* Tab System */
        .tab-active {
            background: linear-gradient(135deg, #d62828, #8b0000);
            color: white;
            border-color: #ffb703;
        }
        
        .tab-inactive {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
            border-color: transparent;
        }
        
        .tab-inactive:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
    </style>
</head>
<body class="texture-parchment font-roboto text-gray-800 overflow-x-hidden">

    <!-- Firebase Config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAYQ1FVg9YwQTb8kuWIfg9KHiUIHBbkpqY",
            authDomain: "one-piece-haber.firebaseapp.com",
            projectId: "one-piece-haber",
            storageBucket: "one-piece-haber.firebasestorage.app",
            messagingSenderId: "292653018558",
            appId: "1:292653018558:web:e275236747771db3329def",
            measurementId: "G-G4NTRHD0YH"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
    </script>

    <!-- Music Player -->
    <div class="music-player glass-premium rounded-full p-3 border-2 border-treasure-gold shadow-lg flex items-center space-x-3">
        <button onclick="toggleMusic()" id="musicBtn" class="w-10 h-10 rounded-full bg-luffy-red text-white flex items-center justify-center hover:scale-110 transition-transform">
            <span id="musicIcon">‚ñ∂Ô∏è</span>
        </button>
        <div class="flex flex-col">
            <span class="text-xs font-bold text-treasure-gold">Binks' Sake</span>
            <input type="range" id="volumeSlider" min="0" max="100" value="20" class="w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer" onchange="setVolume(this.value)">
        </div>
        <audio id="bgMusic" loop>
            <source src="binks_sake.mp3" type="audio/mpeg">
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        </audio>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-90 backdrop-blur-xl transition-all duration-500">
        <div class="glass-premium bg-gradient-to-br from-gray-900 to-black p-10 rounded-2xl max-w-md w-full mx-4 border-2 border-treasure-gold shadow-2xl transform scale-100 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-luffy-red/10 to-ocean-blue/10 pointer-events-none"></div>
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-treasure-gold to-transparent"></div>
            
            <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl transition">&times;</button>
            
            <div class="relative z-10">
                <div class="text-center mb-8">
                    <span class="text-6xl mb-4 block animate-float">‚ò†Ô∏è</span>
                    <h2 class="font-cinzel text-4xl font-bold gradient-text mb-2">KAPTAN Gƒ∞Rƒ∞≈ûƒ∞</h2>
                    <p class="text-gray-400 text-sm tracking-widest">GRAND LINE'A Gƒ∞Rƒ∞≈û ƒ∞ZNƒ∞</p>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-treasure-gold mb-2 font-bold text-sm uppercase">Korsan Adƒ±n</label>
                        <input type="text" id="usernameInput" class="w-full px-4 py-4 rounded-lg bg-black/50 border-2 border-gray-700 text-white focus:border-treasure-gold focus:outline-none transition-all" placeholder="√ñrn: Monkey D. Luffy">
                    </div>
                    
                    <div>
                        <label class="block text-treasure-gold mb-2 font-bold text-sm uppercase">Avatar Se√ß</label>
                        <input type="file" id="avatarFile" accept="image/*" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-gray-700 text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-luffy-red file:text-white hover:file:bg-red-700 transition-all">
                    </div>
                    
                    <button onclick="handleLogin()" class="w-full btn-premium text-white font-bold py-4 px-6 rounded-lg text-lg tracking-wider uppercase">
                        Gƒ∞Rƒ∞≈û YAP
                    </button>
                    
                    <p id="loginError" class="text-red-400 text-sm text-center hidden bg-red-900/30 p-2 rounded border border-red-500/50">Kaptan adƒ± bo≈ü olamaz!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-90 backdrop-blur-xl transition-all duration-500">
        <div class="glass-premium bg-gradient-to-br from-gray-900 to-black p-8 rounded-2xl max-w-2xl w-full mx-4 border-2 border-treasure-gold shadow-2xl relative overflow-hidden max-h-[90vh] overflow-y-auto">
            <div class="absolute inset-0 bg-gradient-to-br from-luffy-red/10 to-ocean-blue/10 pointer-events-none"></div>
            
            <button onclick="closeProfileModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl transition z-50">&times;</button>
            
            <div class="relative z-10">
                <div class="text-center mb-8">
                    <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-luffy-red to-luffy-dark flex items-center justify-center text-4xl border-4 border-treasure-gold shadow-2xl mb-4 relative overflow-hidden">
                        <img id="profileAvatarImg" src="" class="w-full h-full object-cover hidden">
                        <span id="profileAvatarFallback" class="text-4xl">üè¥‚Äç‚ò†Ô∏è</span>
                    </div>
                    <h2 class="font-cinzel text-3xl font-bold gradient-text mb-1" id="profileName">KAPTAN</h2>
                    <p class="text-treasure-gold font-mono text-lg">Bounty: <span id="profileBounty">0</span> ‚Çø</p>
                </div>

                <!-- Tabs -->
                <div class="flex space-x-2 mb-6 border-b border-white/20 pb-4">
                    <button onclick="switchTab('edit')" id="tab-edit" class="flex-1 py-3 px-4 rounded-lg font-bold text-sm tracking-wider transition-all tab-active border-2">PROFƒ∞Lƒ∞ D√úZENLE</button>
                    <button onclick="switchTab('crew')" id="tab-crew" class="flex-1 py-3 px-4 rounded-lg font-bold text-sm tracking-wider transition-all tab-inactive border-2">TAYFA (0)</button>
                    <button onclick="switchTab('alliance')" id="tab-alliance" class="flex-1 py-3 px-4 rounded-lg font-bold text-sm tracking-wider transition-all tab-inactive border-2">ƒ∞TTƒ∞FAK</button>
                </div>

                <!-- Tab Content: Edit Profile -->
                <div id="content-edit" class="space-y-6">
                    <div>
                        <label class="block text-treasure-gold mb-2 font-bold text-sm uppercase">Yeni Avatar</label>
                        <input type="file" id="newAvatarFile" accept="image/*" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-gray-700 text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-luffy-red file:text-white hover:file:bg-red-700 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-treasure-gold mb-2 font-bold text-sm uppercase">Hakkƒ±mda</label>
                        <textarea id="aboutInput" rows="3" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-gray-700 text-white focus:border-treasure-gold focus:outline-none transition-all resize-none" placeholder="Kendinden bahset, Kaptan..."></textarea>
                    </div>
                    
                    <button onclick="saveProfile()" class="w-full btn-gold text-black font-bold py-3 rounded-lg uppercase tracking-wider">
                        KAYDET
                    </button>
                </div>

                <!-- Tab Content: Crew -->
                <div id="content-crew" class="hidden space-y-4">
                    <div class="flex gap-2">
                        <input type="text" id="crewInput" class="flex-1 px-4 py-3 rounded-lg bg-black/50 border-2 border-gray-700 text-white focus:border-treasure-gold focus:outline-none transition-all" placeholder="Tayfa adƒ± gir...">
                        <button onclick="addCrew()" class="btn-premium text-white px-6 py-3 rounded-lg font-bold">EKLE</button>
                    </div>
                    <div id="crewList" class="space-y-2 max-h-60 overflow-y-auto">
                        <p class="text-gray-500 text-center py-8 italic">Hen√ºz tayfan yok. Korsanlar topla!</p>
                    </div>
                </div>

                <!-- Tab Content: Alliance -->
                <div id="content-alliance" class="hidden space-y-6">
                    <div id="noAlliance" class="text-center py-8">
                        <p class="text-gray-400 mb-6">Hen√ºz bir ittifaka katƒ±lmadƒ±n veya klan kurmadƒ±n.</p>
                        
                        <div class="space-y-4 bg-white/5 p-6 rounded-xl border border-white/10">
                            <h3 class="text-treasure-gold font-bold text-lg mb-4">Yeni Klan Kur</h3>
                            
                            <div>
                                <label class="block text-gray-400 mb-2 text-sm uppercase">Klan Adƒ±</label>
                                <input type="text" id="clanNameInput" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-gray-700 text-white focus:border-treasure-gold focus:outline-none transition-all" placeholder="√ñrn: Hasƒ±r ≈ûapka Tayfasƒ±">
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 mb-2 text-sm uppercase">Klan Bayraƒüƒ±</label>
                                <input type="file" id="clanFlagFile" accept="image/*" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-gray-700 text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-ocean-blue file:text-white hover:file:bg-blue-700 transition-all">
                            </div>
                            
                            <button onclick="createClan()" class="w-full btn-gold text-black font-bold py-3 rounded-lg uppercase tracking-wider mt-4">
                                KLAN KUR
                            </button>
                        </div>
                    </div>
                    
                    <div id="hasAlliance" class="hidden text-center">
                        <div class="w-32 h-32 mx-auto rounded-lg bg-gradient-to-br from-luffy-red to-luffy-dark flex items-center justify-center text-6xl border-4 border-treasure-gold shadow-2xl mb-4 overflow-hidden">
                            <img id="clanFlagImg" src="" class="w-full h-full object-cover hidden">
                            <span id="clanFlagFallback" class="hidden">‚öîÔ∏è</span>
                        </div>
                        <h3 class="font-cinzel text-2xl font-bold text-white mb-2" id="clanNameDisplay"></h3>
                        <p class="text-treasure-gold text-sm">Klan Kaptanƒ±</p>
                        <button onclick="leaveClan()" class="mt-6 text-red-400 hover:text-red-300 text-sm underline">Klandan Ayrƒ±l</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- News Detail Modal -->
    <div id="newsModal" class="fixed inset-0 z-40 hidden items-center justify-center bg-black bg-opacity-95 backdrop-blur-xl p-4">
        <div class="glass-premium max-w-4xl w-full rounded-2xl border-2 border-treasure-gold shadow-2xl max-h-[90vh] overflow-y-auto relative">
            <button onclick="closeNewsModal()" class="absolute top-4 right-4 z-50 text-4xl text-treasure-gold hover:text-white font-bold transition transform hover:rotate-90">&times;</button>
            <div id="newsModalContent" class="p-0">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-30 glass-premium border-b-2 border-treasure-gold/50 shadow-epic">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4 group cursor-pointer" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <span class="text-5xl animate-float filter drop-shadow-[0_0_10px_rgba(255,183,3,0.5)] group-hover:scale-110 transition-transform">‚ò†Ô∏è</span>
                <div>
                    <h1 class="font-cinzel text-3xl md:text-4xl font-black gradient-text tracking-widest">ONE PIECE</h1>
                    <p class="font-pirata text-treasure-gold text-lg tracking-[0.3em] subtitle-glow">HABER MERKEZƒ∞</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <div id="userSection" class="hidden items-center space-x-4 glass-premium px-6 py-3 rounded-full border border-treasure-gold/50 shadow-gold cursor-pointer hover:scale-105 transition-transform" onclick="openProfileModal()">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-luffy-red to-luffy-dark flex items-center justify-center text-white font-bold border-2 border-treasure-gold shadow-lg overflow-hidden relative">
                        <img id="navAvatar" src="" class="w-full h-full object-cover hidden">
                        <span id="userAvatar">üè¥‚Äç‚ò†Ô∏è</span>
                    </div>
                    <div class="flex flex-col">
                        <span id="displayUsername" class="text-treasure-gold font-bold text-sm leading-tight tracking-wider uppercase">KAPTAN</span>
                        <span class="text-xs text-gray-300 font-mono">BOUNTY: <span id="bountyDisplay" class="text-treasure-gold font-bold text-lg">0</span> ‚Çø</span>
                    </div>
                </div>
                
                <button id="loginBtn" onclick="openLoginModal()" class="btn-premium text-white font-bold py-3 px-8 rounded-full tracking-wider uppercase text-sm">
                    Giri≈ü Yap
                </button>
                <button id="logoutBtn" onclick="handleLogout()" class="hidden bg-gray-800 hover:bg-gray-700 text-treasure-gold border border-treasure-gold/50 py-2 px-4 rounded-full transition duration-300 text-sm font-bold">
                    √áƒ±kƒ±≈ü
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative py-16 px-4 overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-20 left-10 w-32 h-32 bg-luffy-red rounded-full filter blur-[100px] animate-pulse"></div>
            <div class="absolute bottom-20 right-10 w-40 h-40 bg-ocean-blue rounded-full filter blur-[100px] animate-pulse delay-1000"></div>
        </div>

        <div class="container mx-auto relative z-10">
            <div class="text-center mb-16">
                <h2 class="font-cinzel text-5xl md:text-7xl font-black title-epic mb-6 animate-slide-up">YENƒ∞ D√úNYA</h2>
                <p class="text-xl md:text-2xl text-ocean-blue font-bold tracking-widest subtitle-glow animate-slide-up" style="animation-delay: 0.2s">GRAND LINE'IN EN G√úNCEL HABERLERƒ∞</p>
                <div class="w-32 h-1 bg-gradient-to-r from-transparent via-treasure-gold to-transparent mx-auto mt-6"></div>
            </div>

            <!-- News Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 perspective-1000">
                <!-- Card 1: Manga -->
                <div onclick="openNewsModal('manga')" class="group relative h-[500px] rounded-2xl overflow-hidden cursor-pointer card-glow glass-card transform transition-all duration-500 hover:-translate-y-4 hover:rotate-1">
                    <div class="absolute inset-0 hero-luffy">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-90 group-hover:opacity-70 transition-opacity duration-500"></div>
                    </div>
                    <div class="absolute top-4 left-4 z-20">
                        <span class="bg-luffy-red text-white text-xs font-bold px-4 py-2 rounded-full border border-white/30 shadow-lg backdrop-blur-sm">MANGA</span>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-8 z-20 transform transition-transform duration-500 group-hover:translate-y-[-10px]">
                        <h3 class="font-cinzel text-3xl text-white mb-3 font-bold group-hover:text-treasure-gold transition-colors drop-shadow-lg">B√∂l√ºm 1174: B√ºy√ºk Mola</h3>
                        <p class="text-gray-300 text-sm line-clamp-3 mb-4 leading-relaxed">Elbaf Arkƒ±'nda kritik geli≈ümeler! 1174. b√∂l√ºm detaylarƒ± ve ardƒ±ndan gelecek olan b√ºy√ºk ara hakkƒ±nda √∂nemli bilgiler...</p>
                        <div class="flex items-center text-treasure-gold text-sm font-bold tracking-wider opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <span>DEVAMINI OKU</span>
                            <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </div>
                    </div>
                </div>

                <!-- Card 2: SBS -->
                <div onclick="openNewsModal('sbs')" class="group relative h-[500px] rounded-2xl overflow-hidden cursor-pointer card-glow glass-card transform transition-all duration-500 hover:-translate-y-4 hover:rotate-1" style="animation-delay: 0.1s">
                    <div class="absolute inset-0 hero-robin">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-90 group-hover:opacity-70 transition-opacity duration-500"></div>
                    </div>
                    <div class="absolute top-4 left-4 z-20">
                        <span class="bg-purple-600 text-white text-xs font-bold px-4 py-2 rounded-full border border-white/30 shadow-lg backdrop-blur-sm">SBS</span>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-8 z-20 transform transition-transform duration-500 group-hover:translate-y-[-10px]">
                        <h3 class="font-cinzel text-3xl text-white mb-3 font-bold group-hover:text-treasure-gold transition-colors drop-shadow-lg">Karakter Sƒ±rlarƒ±</h3>
                        <p class="text-gray-300 text-sm line-clamp-3 mb-4 leading-relaxed">Oda Sensei'nin SBS k√∂≈üesinden: Hasƒ±r ≈ûapkalar hangi √ºlkeden olurdu? Banyo yapma sƒ±klƒ±klarƒ± ve daha fazlasƒ±...</p>
                        <div class="flex items-center text-treasure-gold text-sm font-bold tracking-wider opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <span>DEVAMINI OKU</span>
                            <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Anime -->
                <div onclick="openNewsModal('anime')" class="group relative h-[500px] rounded-2xl overflow-hidden cursor-pointer card-glow glass-card transform transition-all duration-500 hover:-translate-y-4 hover:rotate-1" style="animation-delay: 0.2s">
                    <div class="absolute inset-0 hero-zoro">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-90 group-hover:opacity-70 transition-opacity duration-500"></div>
                    </div>
                    <div class="absolute top-4 left-4 z-20">
                        <span class="bg-green-600 text-white text-xs font-bold px-4 py-2 rounded-full border border-white/30 shadow-lg backdrop-blur-sm">ANIME</span>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-8 z-20 transform transition-transform duration-500 group-hover:translate-y-[-10px]">
                        <h3 class="font-cinzel text-3xl text-white mb-3 font-bold group-hover:text-treasure-gold transition-colors drop-shadow-lg">Anime & Remake</h3>
                        <p class="text-gray-300 text-sm line-clamp-3 mb-4 leading-relaxed">Toei Animation g√ºncel durumu ve Wit Studio'nun merakla beklenen One Piece remake'i hakkƒ±nda son geli≈ümeler...</p>
                        <div class="flex items-center text-treasure-gold text-sm font-bold tracking-wider opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <span>DEVAMINI OKU</span>
                            <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12 space-y-16">
        
        <!-- Theory Wall -->
        <section class="glass-premium rounded-3xl p-8 shadow-epic border border-treasure-gold/30 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 h-64 bg-luffy-red rounded-full filter blur-[120px] opacity-20"></div>
            
            <div class="relative z-10">
                <h2 class="font-cinzel text-4xl font-bold text-ocean-blue mb-2 flex items-center">
                    <span class="mr-4 text-5xl">üìù</span>
                    <span class="gradient-text">K√ñ≈ûE YAZARLARI</span>
                </h2>
                <p class="text-gray-600 mb-8 ml-16 font-bold tracking-wider">TEORƒ∞ DUVARI - SENƒ∞N D√ú≈û√úNCEN</p>
                
                <div class="mb-8 relative">
                    <textarea id="theoryInput" rows="4" class="w-full p-6 rounded-xl border-2 border-ocean-blue/30 bg-white/80 backdrop-blur-sm focus:outline-none focus:border-treasure-gold focus:shadow-[0_0_30px_rgba(255,183,3,0.2)] transition-all text-gray-800 font-medium resize-none" placeholder="Kendi One Piece teorini yaz... (√ñrn: Im-sama'nƒ±n ger√ßek kimliƒüi...)"></textarea>
                    <div class="absolute bottom-4 right-4">
                        <button onclick="postTheory()" class="btn-gold text-black font-bold py-3 px-8 rounded-full shadow-lg flex items-center space-x-2">
                            <span>PAYLA≈û</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        </button>
                    </div>
                </div>

                <div id="theoryFeed" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[500px] overflow-y-auto pr-2">
                    <!-- Theories loaded from Firebase -->
                </div>
            </div>
        </section>

        <!-- Game Center: Idle + Quiz + Case Opening -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Idle Game: Haki Training -->
            <div class="glass-premium rounded-3xl p-8 relative overflow-hidden border-2 border-ocean-blue/50 shadow-[0_0_40px_rgba(0,105,148,0.3)]">
                <div class="absolute inset-0 bg-gradient-to-br from-ocean-blue/20 to-transparent pointer-events-none"></div>
                
                <div class="relative z-10">
                    <h2 class="font-cinzel text-3xl font-bold text-ocean-blue mb-6 flex items-center">
                        <span class="mr-3 text-4xl">üí™</span>
                        HAKƒ∞ ANTRENMANI
                    </h2>
                    
                    <div class="text-center mb-6">
                        <div class="text-5xl font-black text-treasure-gold font-cinzel mb-2" id="powerDisplay">0</div>
                        <p class="text-gray-400 text-sm uppercase tracking-wider">G√º√ß Puanƒ±</p>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex justify-between text-sm mb-2 text-gray-400">
                            <span>Seviye: <span id="levelDisplay" class="text-treasure-gold font-bold">1</span></span>
                            <span><span id="autoPower">0</span>/sn Otomatik</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden border border-gray-600">
                            <div id="xpBar" class="power-bar h-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <button onclick="trainHaki()" id="trainBtn" class="w-full btn-premium text-white font-bold py-6 rounded-xl text-xl tracking-wider uppercase mb-4 idle-btn active:scale-95 transition-transform">
                        ANTRENMAN YAP! (+<span id="clickPower">1</span>)
                    </button>
                    
                    <div class="space-y-3">
                        <p class="text-treasure-gold font-bold text-sm uppercase mb-3">Tayfa √úyeleri (Otomatik)</p>
                        
                        <button onclick="buyCrew('zoro')" id="buy-zoro" class="w-full bg-black/40 p-3 rounded-lg border border-white/10 flex justify-between items-center hover:border-green-500/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">‚öîÔ∏è</span>
                                <div class="text-left">
                                    <div class="text-white font-bold text-sm">Zoro</div>
                                    <div class="text-green-400 text-xs">+<span id="zoroPower">5</span>/sn</div>
                                </div>
                            </div>
                            <div class="text-treasure-gold font-bold text-sm"><span id="zoroCost">100</span>‚Çø</div>
                        </button>
                        
                        <button onclick="buyCrew('sanji')" id="buy-sanji" class="w-full bg-black/40 p-3 rounded-lg border border-white/10 flex justify-between items-center hover:border-blue-500/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üç≥</span>
                                <div class="text-left">
                                    <div class="text-white font-bold text-sm">Sanji</div>
                                    <div class="text-blue-400 text-xs">+<span id="sanjiPower">15</span>/sn</div>
                                </div>
                            </div>
                            <div class="text-treasure-gold font-bold text-sm"><span id="sanjiCost">500</span>‚Çø</div>
                        </button>
                        
                        <button onclick="buyCrew('jinbe')" id="buy-jinbe" class="w-full bg-black/40 p-3 rounded-lg border border-white/10 flex justify-between items-center hover:border-orange-500/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">üåä</span>
                                <div class="text-left">
                                    <div class="text-white font-bold text-sm">Jinbe</div>
                                    <div class="text-orange-400 text-xs">+<span id="jinbePower">50</span>/sn</div>
                                </div>
                            </div>
                            <div class="text-treasure-gold font-bold text-sm"><span id="jinbeCost">2000</span>‚Çø</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Extended Quiz -->
            <div class="glass-premium rounded-3xl p-8 relative overflow-hidden border-2 border-luffy-red/50 shadow-[0_0_40px_rgba(214,40,40,0.3)]">
                <div class="absolute inset-0 bg-gradient-to-br from-luffy-red/20 to-transparent pointer-events-none"></div>
                
                <div class="relative z-10">
                    <h2 class="font-cinzel text-3xl font-bold text-treasure-gold mb-6 flex items-center">
                        <span class="mr-3 text-4xl">‚öîÔ∏è</span>
                        GRAND LINE QUIZ
                    </h2>
                    
                    <div id="quizContainer" class="bg-black/40 rounded-2xl p-6 backdrop-blur-sm border border-white/10">
                        <div id="quizQuestion" class="text-xl font-bold mb-6 min-h-[80px] text-white leading-relaxed">Hazƒ±r mƒ±sƒ±n Kaptan? ƒ∞lk soru i√ßin ba≈üla!</div>
                        
                        <div id="quizOptions" class="grid grid-cols-1 gap-3 mb-6">
                            <button onclick="startQuiz()" class="btn-gold text-black font-bold py-4 px-6 rounded-xl text-lg tracking-wider uppercase shadow-lg animate-pulse-glow">
                                MACERA BA≈ûLASIN
                            </button>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-white/20">
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-400 text-sm uppercase tracking-wider">Skor</span>
                                <span id="quizScore" class="font-cinzel text-2xl font-bold text-treasure-gold">0</span>
                                <span class="text-gray-500">/10</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-400 text-sm uppercase tracking-wider">Soru</span>
                                <span id="quizQuestionNum" class="font-cinzel text-2xl font-bold text-white">0</span>
                                <span class="text-gray-500">/10</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CS2 Style Case Opening -->
            <div class="glass-premium rounded-3xl p-8 relative overflow-hidden border-2 border-purple-500/50 shadow-[0_0_40px_rgba(147,51,234,0.3)]">
                <div class="absolute inset-0 bg-gradient-to-br from-purple-900/30 to-transparent pointer-events-none"></div>
                
                <div class="relative z-10">
                    <h2 class="font-cinzel text-3xl font-bold text-purple-300 mb-6 flex items-center">
                        <span class="mr-3 text-4xl">üé∞</span>
                        MEYVE KASASI
                    </h2>
                    
                    <div class="case-container mb-6 relative">
                        <div class="case-selector"></div>
                        <div id="caseStrip" class="case-strip">
                            <!-- Items generated by JS -->
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-gray-400 text-sm">Kasa Fiyatƒ±: <span class="text-treasure-gold font-bold">100‚Çø</span></span>
                        <span id="caseResult" class="text-purple-300 font-bold min-h-[24px]"></span>
                    </div>
                    
                    <button onclick="openCase()" id="caseBtn" class="w-full btn-gold text-black font-bold py-4 rounded-xl text-lg tracking-wider uppercase shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed">
                        KASA A√á
                    </button>
                </div>
            </div>
        </section>

        <!-- Social Area & Sidebar -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Real-time Chat (Firebase) -->
            <div class="lg:col-span-2 glass-premium rounded-3xl overflow-hidden shadow-2xl border-2 border-gray-700 relative h-[600px] flex flex-col">
                <div class="absolute inset-0 bg-xebec opacity-30"></div>
                <div class="absolute inset-0 bg-gradient-to-b from-black/80 via-black/60 to-black/80"></div>
                
                <div class="relative z-10 p-6 border-b border-white/10 bg-gradient-to-r from-black/50 to-transparent">
                    <h3 class="font-cinzel text-3xl font-bold text-treasure-gold flex items-center">
                        <span class="mr-3 text-4xl">üí¨</span>
                        GER√áEK ZAMANLI SOHBET
                        <span class="ml-auto flex items-center text-xs bg-green-600/80 px-3 py-1 rounded-full border border-green-400/50 animate-pulse">
                            <span class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-ping"></span>
                            CANLI
                        </span>
                    </h3>
                </div>
                
                <div id="chatMessages" class="relative z-10 flex-1 overflow-y-auto p-6 space-y-4">
                    <!-- Messages loaded from Firebase -->
                </div>
                
                <div class="relative z-10 p-6 bg-gradient-to-t from-black/80 to-transparent border-t border-white/10">
                    <div class="flex gap-3">
                        <input type="text" id="chatInput" class="flex-1 bg-gray-900/80 border-2 border-gray-700 rounded-xl px-5 py-4 text-white placeholder-gray-500 focus:outline-none focus:border-treasure-gold focus:shadow-[0_0_20px_rgba(255,183,3,0.2)] transition-all" placeholder="Mesajƒ±n..." onkeypress="if(event.key === 'Enter') sendChat()">
                        <button onclick="sendChat()" class="btn-premium text-white px-6 py-4 rounded-xl font-bold transition transform hover:scale-105">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Poll -->
                <div class="glass-premium p-8 rounded-3xl shadow-epic border-2 border-luffy-red/30 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-luffy-red rounded-full filter blur-[80px] opacity-20"></div>
                    
                    <h3 class="font-cinzel text-2xl font-bold text-luffy-red mb-6 flex items-center">
                        <span class="mr-2">üìä</span>
                        HAFTANIN ANKETƒ∞
                    </h3>
                    
                    <p class="font-bold mb-6 text-gray-700 text-sm uppercase tracking-wider">Korsanlar Kralƒ± Kim Olacak?</p>
                    
                    <div id="pollContainer" class="space-y-4">
                        <button onclick="votePoll('luffy')" class="w-full group">
                            <div class="flex justify-between text-sm mb-2 font-bold text-gray-700 group-hover:text-luffy-red transition-colors">
                                <span class="flex items-center"><span class="w-2 h-2 bg-luffy-red rounded-full mr-2"></span>Luffy</span>
                                <span id="pct-luffy" class="font-mono">45%</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden border border-gray-400 shadow-inner">
                                <div id="bar-luffy" class="bg-gradient-to-r from-luffy-red to-red-600 h-full transition-all duration-1000 shadow-lg" style="width: 45%"></div>
                            </div>
                        </button>
                        
                        <button onclick="votePoll('buggy')" class="w-full group">
                            <div class="flex justify-between text-sm mb-2 font-bold text-gray-700 group-hover:text-orange-600 transition-colors">
                                <span class="flex items-center"><span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>Buggy</span>
                                <span id="pct-buggy" class="font-mono">15%</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden border border-gray-400 shadow-inner">
                                <div id="bar-buggy" class="bg-gradient-to-r from-orange-500 to-orange-600 h-full transition-all duration-1000 shadow-lg" style="width: 15%"></div>
                            </div>
                        </button>
                        
                        <button onclick="votePoll('teach')" class="w-full group">
                            <div class="flex justify-between text-sm mb-2 font-bold text-gray-700 group-hover:text-purple-900 transition-colors">
                                <span class="flex items-center"><span class="w-2 h-2 bg-purple-900 rounded-full mr-2"></span>Teach</span>
                                <span id="pct-teach" class="font-mono">25%</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden border border-gray-400 shadow-inner">
                                <div id="bar-teach" class="bg-gradient-to-r from-purple-900 to-purple-800 h-full transition-all duration-1000 shadow-lg" style="width: 25%"></div>
                            </div>
                        </button>
                        
                        <button onclick="votePoll('shanks')" class="w-full group">
                            <div class="flex justify-between text-sm mb-2 font-bold text-gray-700 group-hover:text-red-800 transition-colors">
                                <span class="flex items-center"><span class="w-2 h-2 bg-red-800 rounded-full mr-2"></span>Shanks</span>
                                <span id="pct-shanks" class="font-mono">15%</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden border border-gray-400 shadow-inner">
                                <div id="bar-shanks" class="bg-gradient-to-r from-red-800 to-red-900 h-full transition-all duration-1000 shadow-lg" style="width: 15%"></div>
                            </div>
                        </button>
                    </div>
                    
                    <div id="pollMessage" class="mt-4 p-3 bg-green-100 border border-green-500 rounded-lg text-center hidden animate-slide-up">
                        <p class="text-green-800 font-bold text-sm">‚úì Oy kullandƒ±n! Bounty +10‚Çø</p>
                    </div>
                </div>

                <!-- Countdown -->
                <div class="glass-premium p-8 rounded-3xl shadow-epic border-2 border-ocean-blue/30 relative overflow-hidden">
                    <div class="absolute inset-0 bg-aokiji opacity-40"></div>
                    <div class="absolute inset-0 bg-gradient-to-b from-ocean-blue/80 to-ocean-deep/90"></div>
                    
                    <div class="relative z-10">
                        <h3 class="font-cinzel text-2xl font-bold text-treasure-gold mb-6 flex items-center">
                            <span class="mr-2">‚è∞</span>
                            GERƒ∞ SAYIM
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="bg-black/40 p-4 rounded-xl border border-white/10 backdrop-blur-sm">
                                <div class="text-xs text-gray-300 mb-1 uppercase tracking-wider font-bold">Manga B√∂l√ºm 1175</div>
                                <div id="countdown-manga" class="font-cinzel text-2xl font-bold text-treasure-gold tracking-wider">00:00:00</div>
                            </div>
                            
                            <div class="bg-black/40 p-4 rounded-xl border border-white/10 backdrop-blur-sm">
                                <div class="text-xs text-gray-300 mb-1 uppercase tracking-wider font-bold">Anime B√∂l√ºm 1111</div>
                                <div id="countdown-anime" class="font-cinzel text-2xl font-bold text-treasure-gold tracking-wider">00:00:00</div>
                            </div>
                            
                            <div class="bg-black/40 p-4 rounded-xl border border-white/10 backdrop-blur-sm">
                                <div class="text-xs text-gray-300 mb-1 uppercase tracking-wider font-bold">Live Action S2</div>
                                <div id="countdown-live" class="font-cinzel text-2xl font-bold text-treasure-gold tracking-wider">00:00:00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Leaderboard -->
                <div class="glass-premium p-8 rounded-3xl shadow-epic border-2 border-treasure-gold/50 bg-gradient-to-b from-yellow-100/80 to-yellow-200/80">
                    <h3 class="font-cinzel text-2xl font-bold text-yellow-800 mb-6 flex items-center">
                        <span class="mr-2">üèÜ</span>
                        Lƒ∞DERLƒ∞K TABLOSU
                    </h3>
                    
                    <ul id="leaderboardList" class="space-y-3">
                        <!-- JS ile doldurulacak -->
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="relative bg-gray-900 text-parchment py-16 mt-20 border-t-4 border-luffy-red overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"></div>
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-3/4 h-px bg-gradient-to-r from-transparent via-treasure-gold to-transparent"></div>
        
        <div class="container mx-auto px-4 text-center relative z-10">
            <div class="mb-8">
                <span class="text-6xl mb-4 block animate-float">‚ò†Ô∏è</span>
                <p class="font-cinzel text-4xl font-bold gradient-text mb-2">ONE PIECE HABER</p>
                <p class="font-pirata text-treasure-gold text-xl tracking-[0.5em]">YENƒ∞ D√úNYA</p>
            </div>
            
            <div class="w-full max-w-md mx-auto h-px bg-gradient-to-r from-transparent via-gray-600 to-transparent mb-8"></div>
            
            <p class="text-sm text-gray-500 mb-2">¬© 2024 Yeni D√ºnya Medya. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
            <p class="text-xs text-gray-600">Bu site hayran yapƒ±mƒ±dƒ±r ve resmi bir baƒülantƒ±sƒ± yoktur.</p>
            <p class="text-xs text-gray-600 mt-4 font-mono">"Hayallerinin pe≈üinden gitmekten asla vazge√ßme!"</p>
        </div>
    </footer>

    <script>
        // ==================== FIREBASE CONFIG & INIT ====================
        const firebaseConfig = {
            apiKey: "AIzaSyAYQ1FVg9YwQTb8kuWIfg9KHiUIHBbkpqY",
            authDomain: "one-piece-haber.firebaseapp.com",
            projectId: "one-piece-haber",
            storageBucket: "one-piece-haber.firebasestorage.app",
            messagingSenderId: "292653018558",
            appId: "1:292653018558:web:e275236747771db3329def",
            measurementId: "G-G4NTRHD0YH"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ==================== EXTENDED QUESTION POOL (30 Questions) ====================
        const allQuestions = [
            {q:"Luffy'nin ≈üeytan meyvesinin ger√ßek adƒ±?", a:["Gomu Gomu","Hito Hito: Nika","Mera Mera","Yami Yami"], c:1},
            {q:"Zoro'nun ustasƒ±?", a:["Mihawk","Koshiro","Rayleigh","Oden"], c:1},
            {q:"One Piece'i yazan ki≈üi?", a:["Toriyama","Kishimoto","Oda","Kubo"], c:2},
            {q:"Roger'ƒ±n idam edildiƒüi yer?", a:["Marineford","Loguetown","Wano","Dressrosa"], c:1},
            {q:"Nami'nin harita tutkusu neden?", a:["Hazine","Bellemere","Para","Arlong"], c:1},
            {q:"Sanji'nin ailesi?", a:["Charlotte","Vinsmoke","Donquixote","Rocks"], c:1},
            {q:"Zoro'nun kayƒ±p g√∂z√º?", a:["Sol","Saƒü","ƒ∞kisi de","Hi√ßbiri"], c:0},
            {q:"Im-sama ilk g√∂r√ºld√ºƒü√º b√∂l√ºm?", a:["906","908","957","1000"], c:1},
            {q:"Grand Line ge√ßi≈ü ≈üartƒ±?", a:["Harita","Log Pose","Gemici","Denizcilik"], c:1},
            {q:"Brook'un meyvesi?", a:["Yomi Yomi","Gura Gura","Ope Ope","Hito Hito"], c:0},
            {q:"Chopper'ƒ±n mesleƒüi?", a:["Sniper","Doktor","Tersane","A≈ü√ßƒ±"], c:1},
            {q:"Franky'nin ilk ismi?", a:["Cutty Flam","Froggy","Iron Man","Cyborg"], c:0},
            {q:"Robin'in ilk g√∂r√ºnd√ºƒü√º arc?", a:["Alabasta","Skypiea","Water 7","Enies Lobby"], c:0},
            {q:"Joy Boy'un mesajƒ± nerede?", a:["Laugh Tale","Fish-Man Island","Zou","Marie Geoise"], c:1},
            {q:"Kaido'nun meyvesi?", a:["Uo Uo","Tori Tori","Ryu Ryu","Hebi Hebi"], c:0},
            {q:"Big Mom'ƒ±n ger√ßek adƒ±?", a:["Charlotte Linlin","Linlin Charlotte","Lin Charlotte","Char Linlin"], c:0},
            {q:"Shanks'in kƒ±lƒ±cƒ±?", a:["Gryphon","Enma","Wado","Sandai Kitetsu"], c:0},
            {q:"Whitebeard'ƒ±n gemisi?", a:["Moby Dick","Red Force","Thousand Sunny","Oro Jackson"], c:0},
            {q:"Ace'in annesi?", a:["Rouge","Portgas","Rouge Portgas","Anne yok"], c:0},
            {q:"Luffy'nin annesi biliniyor mu?", a:["Evet","Hayƒ±r","Belki","Oda a√ßƒ±klamadƒ±"], c:1},
            {q:"Garp'ƒ±n lakabƒ±?", a:["Kahraman","Demir Yumruk","Denizci","Amiral"], c:1},
            {q:"Aokiji'nin ger√ßek adƒ±?", a:["Kuzan","Borsalino","Sakazuki","Issho"], c:0},
            {q:"Akainu'nun meyvesi?", a:["Magu Magu","Pika Pika","Mera Mera","Goro Goro"], c:0},
            {q:"Kizaru'nun meyvesi?", a:["Pika Pika","Magu Magu","Hie Hie","Goro Goro"], c:0},
            {q:"Enel'in meyvesi?", a:["Goro Goro","Pika Pika","Mera Mera","Gura Gura"], c:0},
            {q:"Blackbeard'in ilk meyvesi?", a:["Yami Yami","Gura Gura","Goro Goro","Mera Mera"], c:0},
            {q:"Law'un meyvesi?", a:["Ope Ope","Hito Hito","Gomu Gomu","Yami Yami"], c:0},
            {q:"Doflamingo'nun meyvesi?", a:["Ito Ito","Hito Hito","Gomu Gomu","Bara Bara"], c:0},
            {q:"Buggy'nin meyvesi?", a:["Bara Bara","Ito Ito","Sube Sube","Bomu Bomu"], c:0},
            {q:"Luffy'nin ilk yemekliƒüi?", a:["Shanks","Zoro","Ace","Garp"], c:0}
        ];

        // ==================== DEVIL FRUITS FOR CASE OPENING ====================
        const caseItems = [
            { name: "Gomu Gomu no Mi", icon: "üçå", color: "#d62828", value: 100, rarity: "common" },
            { name: "Bara Bara no Mi", icon: "üé™", color: "#ff6b35", value: 80, rarity: "common" },
            { name: "Sube Sube no Mi", icon: "üíÉ", color: "#ff69b4", value: 90, rarity: "common" },
            { name: "Bomu Bomu no Mi", icon: "üí£", color: "#8b4513", value: 120, rarity: "uncommon" },
            { name: "Kilo Kilo no Mi", icon: "‚öñÔ∏è", color: "#9370db", value: 110, rarity: "uncommon" },
            { name: "Hana Hana no Mi", icon: "üå∏", color: "#ff1493", value: 150, rarity: "uncommon" },
            { name: "Doru Doru no Mi", icon: "üïØÔ∏è", color: "#f5deb3", value: 130, rarity: "uncommon" },
            { name: "Baku Baku no Mi", icon: "üçΩÔ∏è", color: "#8b0000", value: 140, rarity: "rare" },
            { name: "Mane Mane no Mi", icon: "üé≠", color: "#ff6347", value: 160, rarity: "rare" },
            { name: "Tori Tori no Mi", icon: "ü¶Ö", color: "#ffd700", value: 200, rarity: "rare" },
            { name: "Mera Mera no Mi", icon: "üî•", color: "#ff4500", value: 250, rarity: "epic" },
            { name: "Ope Ope no Mi", icon: "‚ù§Ô∏è", color: "#dc143c", value: 300, rarity: "epic" },
            { name: "Gura Gura no Mi", icon: "üåç", color: "#8b4513", value: 400, rarity: "legendary" },
            { name: "Yami Yami no Mi", icon: "üåë", color: "#2f2f2f", value: 350, rarity: "legendary" },
            { name: "Hito Hito no Mi: Nika", icon: "‚òÄÔ∏è", color: "#ffd700", value: 500, rarity: "mythic" }
        ];

        // ==================== STATE ====================
        let state = {
            user: null,
            userId: null,
            bounty: 100,
            power: 0,
            level: 1,
            xp: 0,
            crew: { zoro: 0, sanji: 0, jinbe: 0 },
            quiz: { active: false, current: 0, score: 0, questions: [] },
            pollVoted: false,
            profile: { avatar: '', about: '', crewList: [], clan: null }
        };

        let idleInterval;
        let isMusicPlaying = false;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initCaseStrip();
            startCountdowns();
            loadLeaderboard();
            
            // Check auth state
            auth.onAuthStateChanged(user => {
                if (user) {
                    state.userId = user.uid;
                    loadUserData(user.uid);
                } else {
                    // Anonymous auth for demo
                    auth.signInAnonymously().catch(console.error);
                }
            });

            // Real-time listeners
            setupRealtimeListeners();
        });

        // ==================== MUSIC PLAYER ====================
        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            const icon = document.getElementById('musicIcon');
            
            if (isMusicPlaying) {
                audio.pause();
                icon.textContent = '‚ñ∂Ô∏è';
                isMusicPlaying = false;
            } else {
                audio.volume = 0.2;
                audio.play().catch(e => console.log('Audio play failed:', e));
                icon.textContent = '‚è∏Ô∏è';
                isMusicPlaying = true;
            }
        }

        function setVolume(val) {
            const audio = document.getElementById('bgMusic');
            audio.volume = val / 100;
        }

        // ==================== FIREBASE FUNCTIONS ====================
        async function loadUserData(uid) {
            const doc = await db.collection('users').doc(uid).get();
            if (doc.exists) {
                const data = doc.data();
                state.user = data.name;
                state.bounty = data.bounty || 100;
                state.power = data.power || 0;
                state.level = data.level || 1;
                state.crew = data.crew || { zoro: 0, sanji: 0, jinbe: 0 };
                state.profile = data.profile || { avatar: '', about: '', crewList: [], clan: null };
                updateUI();
                startIdleGame();
            }
        }

        async function saveUserData() {
            if (!state.userId) return;
            await db.collection('users').doc(state.userId).set({
                name: state.user,
                bounty: state.bounty,
                power: state.power,
                level: state.level,
                crew: state.crew,
                profile: state.profile,
                lastActive: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
        }

        function setupRealtimeListeners() {
            // Chat messages
            db.collection('chat').orderBy('timestamp', 'desc').limit(50).onSnapshot(snapshot => {
                const container = document.getElementById('chatMessages');
                container.innerHTML = '';
                snapshot.docs.reverse().forEach(doc => {
                    const msg = doc.data();
                    addChatMessageToDOM(msg.sender, msg.text, msg.sender === 'Sistem', msg.avatar);
                });
            });

            // Theories
            db.collection('theories').orderBy('timestamp', 'desc').limit(10).onSnapshot(snapshot => {
                const container = document.getElementById('theoryFeed');
                container.innerHTML = '';
                snapshot.docs.forEach(doc => {
                    const theory = doc.data();
                    addTheoryToDOM(theory.author, theory.text, theory.timestamp);
                });
            });
        }

        // ==================== AUTH & PROFILE ====================
        async function handleLogin() {
            const name = document.getElementById('usernameInput').value.trim();
            if (!name) {
                document.getElementById('loginError').classList.remove('hidden');
                return;
            }

            const fileInput = document.getElementById('avatarFile');
            let avatarBase64 = '';
            
            if (fileInput.files[0]) {
                avatarBase64 = await fileToBase64(fileInput.files[0]);
            }

            state.user = name;
            state.profile.avatar = avatarBase64;
            
            await saveUserData();
            updateUI();
            closeLoginModal();
            
            // Add welcome message
            await db.collection('chat').add({
                sender: 'Sistem',
                text: `üè¥‚Äç‚ò†Ô∏è Ho≈ügeldin Kaptan ${name}! Yeni D√ºnya maceran ba≈ülƒ±yor!`,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                avatar: ''
            });
            
            playSound('coin');
            startIdleGame();
        }

        function handleLogout() {
            auth.signOut().then(() => {
                location.reload();
            });
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function updateUI() {
            if (state.user) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('userSection').classList.remove('hidden');
                document.getElementById('userSection').classList.add('flex');
                document.getElementById('displayUsername').textContent = state.user;
                document.getElementById('bountyDisplay').textContent = state.bounty.toLocaleString();
                
                if (state.profile.avatar) {
                    document.getElementById('navAvatar').src = state.profile.avatar;
                    document.getElementById('navAvatar').classList.remove('hidden');
                    document.getElementById('userAvatar').classList.add('hidden');
                }
            }
        }

        // ==================== PROFILE MODAL FUNCTIONS ====================
        function openProfileModal() {
            if (!state.user) {
                openLoginModal();
                return;
            }
            
            document.getElementById('profileModal').classList.remove('hidden');
            document.getElementById('profileModal').classList.add('flex');
            
            document.getElementById('profileName').textContent = state.user;
            document.getElementById('profileBounty').textContent = state.bounty.toLocaleString();
            
            if (state.profile.avatar) {
                document.getElementById('profileAvatarImg').src = state.profile.avatar;
                document.getElementById('profileAvatarImg').classList.remove('hidden');
                document.getElementById('profileAvatarFallback').classList.add('hidden');
            }
            
            document.getElementById('aboutInput').value = state.profile.about || '';
            updateCrewList();
            updateClanDisplay();
            switchTab('edit');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.add('hidden');
            document.getElementById('profileModal').classList.remove('flex');
        }

        function switchTab(tabName) {
            ['edit', 'crew', 'alliance'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('tab-inactive');
            });
            
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.remove('tab-inactive');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
            
            if (tabName === 'crew') {
                document.getElementById('tab-crew').textContent = `TAYFA (${state.profile.crewList?.length || 0})`;
            }
        }

        async function saveProfile() {
            const fileInput = document.getElementById('newAvatarFile');
            const about = document.getElementById('aboutInput').value.trim();
            
            if (fileInput.files[0]) {
                state.profile.avatar = await fileToBase64(fileInput.files[0]);
            }
            
            state.profile.about = about;
            await saveUserData();
            updateUI();
            
            playSound('coin');
            addBounty(20);
            alert('Profil g√ºncellendi! (+20‚Çø)');
        }

        async function addCrew() {
            const name = document.getElementById('crewInput').value.trim();
            if (!name) return;
            
            if (!state.profile.crewList) state.profile.crewList = [];
            
            if (state.profile.crewList.includes(name)) {
                alert('Bu korsan zaten tayfanda!');
                return;
            }
            
            state.profile.crewList.push(name);
            await saveUserData();
            updateCrewList();
            document.getElementById('crewInput').value = '';
            playSound('coin');
            addBounty(10);
        }

        function updateCrewList() {
            const list = document.getElementById('crewList');
            const crew = state.profile.crewList || [];
            
            if (crew.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8 italic">Hen√ºz tayfan yok. Korsanlar topla!</p>';
            } else {
                list.innerHTML = crew.map((member, idx) => `
                    <div class="flex justify-between items-center bg-white/10 p-3 rounded-lg border border-white/20">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-luffy-red to-luffy-dark flex items-center justify-center text-white font-bold border border-treasure-gold">
                                ${member.charAt(0).toUpperCase()}
                            </div>
                            <span class="text-white font-bold">${member}</span>
                        </div>
                        <button onclick="removeCrew(${idx})" class="text-red-400 hover:text-red-300 text-sm">√ó</button>
                    </div>
                `).join('');
            }
        }

        async function removeCrew(index) {
            state.profile.crewList.splice(index, 1);
            await saveUserData();
            updateCrewList();
        }

        async function createClan() {
            const name = document.getElementById('clanNameInput').value.trim();
            const fileInput = document.getElementById('clanFlagFile');
            
            if (!name) {
                alert('Klan adƒ± girmelisin!');
                return;
            }
            
            let flagBase64 = '';
            if (fileInput.files[0]) {
                flagBase64 = await fileToBase64(fileInput.files[0]);
            }
            
            state.profile.clan = { name, flag: flagBase64 };
            await saveUserData();
            updateClanDisplay();
            playSound('win');
            addBounty(50);
            alert(`${name} klanƒ± kuruldu! (+50‚Çø)`);
        }

        function updateClanDisplay() {
            const noAlliance = document.getElementById('noAlliance');
            const hasAlliance = document.getElementById('hasAlliance');
            
            if (state.profile.clan) {
                noAlliance.classList.add('hidden');
                hasAlliance.classList.remove('hidden');
                document.getElementById('clanNameDisplay').textContent = state.profile.clan.name;
                
                if (state.profile.clan.flag) {
                    document.getElementById('clanFlagImg').src = state.profile.clan.flag;
                    document.getElementById('clanFlagImg').classList.remove('hidden');
                    document.getElementById('clanFlagFallback').classList.add('hidden');
                }
            } else {
                noAlliance.classList.remove('hidden');
                hasAlliance.classList.add('hidden');
            }
        }

        async function leaveClan() {
            if (confirm('Klandan ayrƒ±lmak istediƒüine emin misin?')) {
                state.profile.clan = null;
                await saveUserData();
                updateClanDisplay();
            }
        }

        function addBounty(amount) {
            state.bounty += amount;
            document.getElementById('bountyDisplay').textContent = state.bounty.toLocaleString();
            saveUserData();
        }

        // ==================== IDLE GAME ====================
        function startIdleGame() {
            if (idleInterval) clearInterval(idleInterval);
            
            idleInterval = setInterval(() => {
                const autoPower = (state.crew.zoro * 5) + (state.crew.sanji * 15) + (state.crew.jinbe * 50);
                if (autoPower > 0) {
                    state.power += autoPower;
                    updateIdleUI();
                    checkLevelUp();
                }
            }, 1000);
        }

        function trainHaki() {
            const clickPower = 1 + Math.floor(state.level / 5);
            state.power += clickPower;
            state.xp += clickPower;
            updateIdleUI();
            checkLevelUp();
            playSound('coin');
            
            // Visual feedback
            const btn = document.getElementById('trainBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => btn.style.transform = 'scale(1)', 100);
        }

        function updateIdleUI() {
            document.getElementById('powerDisplay').textContent = state.power.toLocaleString();
            document.getElementById('levelDisplay').textContent = state.level;
            
            const autoPower = (state.crew.zoro * 5) + (state.crew.sanji * 15) + (state.crew.jinbe * 50);
            document.getElementById('autoPower').textContent = autoPower;
            
            const clickPower = 1 + Math.floor(state.level / 5);
            document.getElementById('clickPower').textContent = clickPower;
            
            const xpNeeded = state.level * 100;
            const xpPercent = Math.min((state.xp / xpNeeded) * 100, 100);
            document.getElementById('xpBar').style.width = xpPercent + '%';
            
            // Update costs
            document.getElementById('zoroCost').textContent = (100 * Math.pow(1.5, state.crew.zoro)).toFixed(0);
            document.getElementById('sanjiCost').textContent = (500 * Math.pow(1.5, state.crew.sanji)).toFixed(0);
            document.getElementById('jinbeCost').textContent = (2000 * Math.pow(1.5, state.crew.jinbe)).toFixed(0);
        }

        function checkLevelUp() {
            const xpNeeded = state.level * 100;
            if (state.xp >= xpNeeded) {
                state.level++;
                state.xp = 0;
                playSound('win');
                alert(`Seviye atladƒ±n! Yeni seviye: ${state.level}`);
            }
        }

        async function buyCrew(type) {
            const costs = {
                zoro: 100 * Math.pow(1.5, state.crew.zoro),
                sanji: 500 * Math.pow(1.5, state.crew.sanji),
                jinbe: 2000 * Math.pow(1.5, state.crew.jinbe)
            };
            
            if (state.bounty >= costs[type]) {
                state.bounty -= costs[type];
                state.crew[type]++;
                await saveUserData();
                updateUI();
                updateIdleUI();
                playSound('coin');
            } else {
                alert('Yeterli Bounty yok!');
            }
        }

        // ==================== QUIZ GAME ====================
        function startQuiz() {
            state.quiz.active = true;
            state.quiz.current = 0;
            state.quiz.score = 0;
            
            // Shuffle and pick 10 random questions
            const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
            state.quiz.questions = shuffled.slice(0, 10);
            
            document.getElementById('quizScore').textContent = '0';
            showQuestion();
        }

        function showQuestion() {
            if (state.quiz.current >= 10) {
                endQuiz();
                return;
            }
            
            const q = state.quiz.questions[state.quiz.current];
            document.getElementById('quizQuestionNum').textContent = state.quiz.current + 1;
            document.getElementById('quizQuestion').innerHTML = `<span class="text-treasure-gold font-cinzel text-2xl mr-2">Soru ${state.quiz.current + 1}:</span> ${q.q}`;
            
            const optionsDiv = document.getElementById('quizOptions');
            optionsDiv.innerHTML = '';
            
            q.a.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'w-full bg-white/10 hover:bg-white/20 border-2 border-white/30 text-white font-bold py-4 px-6 rounded-xl transition-all text-left flex items-center group hover:border-treasure-gold';
                btn.innerHTML = `<span class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mr-4 text-sm group-hover:bg-treasure-gold group-hover:text-black transition-colors">${String.fromCharCode(65 + idx)}</span><span>${opt}</span>`;
                btn.onclick = () => checkAnswer(idx);
                optionsDiv.appendChild(btn);
            });
        }

        function checkAnswer(idx) {
            const q = state.quiz.questions[state.quiz.current];
            const buttons = document.getElementById('quizOptions').children;
            
            if (idx === q.c) {
                buttons[idx].classList.remove('bg-white/10', 'border-white/30');
                buttons[idx].classList.add('bg-green-500/50', 'border-green-400');
                state.quiz.score++;
                document.getElementById('quizScore').textContent = state.quiz.score;
                addBounty(50);
                playSound('correct');
            } else {
                buttons[idx].classList.remove('bg-white/10', 'border-white/30');
                buttons[idx].classList.add('bg-red-600/50', 'border-red-400');
                buttons[q.c].classList.add('bg-green-500/50', 'border-green-400');
                playSound('wrong');
            }
            
            setTimeout(() => {
                state.quiz.current++;
                showQuestion();
            }, 1500);
        }

        function endQuiz() {
            const container = document.getElementById('quizContainer');
            const finalScore = state.quiz.score;
            const bonus = finalScore === 10 ? 500 : finalScore * 50;
            
            container.innerHTML = `
                <div class="text-center py-12 animate-slide-up">
                    <div class="text-8xl mb-6 animate-bounce">üèÜ</div>
                    <h3 class="font-cinzel text-4xl font-bold text-treasure-gold mb-4">Quiz Tamamlandƒ±!</h3>
                    <div class="text-6xl font-black text-white mb-4 font-cinzel">${finalScore}<span class="text-2xl text-gray-400">/10</span></div>
                    <p class="text-xl text-gray-300 mb-2">Tebrikler Kaptan!</p>
                    <div class="bg-treasure-gold/20 border-2 border-treasure-gold rounded-xl p-4 mb-8 inline-block">
                        <p class="text-treasure-gold font-bold text-xl">Bonus Kazancƒ±n: +${bonus}‚Çø</p>
                    </div>
                    <div>
                        <button onclick="location.reload()" class="btn-gold text-black font-bold py-4 px-10 rounded-full text-lg shadow-2xl hover:scale-110 transition-transform">
                            TEKRAR OYNA
                        </button>
                    </div>
                </div>
            `;
            addBounty(bonus);
        }

        // ==================== CASE OPENING (CS2 STYLE) ====================
        function initCaseStrip() {
            const strip = document.getElementById('caseStrip');
            // Generate many items for the strip
            let html = '';
            for (let i = 0; i < 50; i++) {
                const item = caseItems[Math.floor(Math.random() * caseItems.length)];
                html += `
                    <div class="case-item" style="border-color: ${item.color}; background: linear-gradient(135deg, ${item.color}20, #000);">
                        <div class="text-3xl">${item.icon}</div>
                        <div class="text-xs text-center mt-1 font-bold" style="color: ${item.color}">${item.name}</div>
                    </div>
                `;
            }
            strip.innerHTML = html;
        }

        async function openCase() {
            if (!state.user) {
                openLoginModal();
                return;
            }
            
            if (state.bounty < 100) {
                alert('Yeterli Bounty yok! (Gereken: 100‚Çø)');
                return;
            }
            
            addBounty(-100);
            playSound('spin');
            
            const btn = document.getElementById('caseBtn');
            const strip = document.getElementById('caseStrip');
            const result = document.getElementById('caseResult');
            
            btn.disabled = true;
            result.textContent = '';
            
            // Determine winning item
            const winningItem = caseItems[Math.floor(Math.random() * caseItems.length)];
            
            // Animation
            const randomOffset = Math.floor(Math.random() * 800) + 400;
            strip.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            strip.style.transform = `translateX(-${randomOffset}px)`;
            
            setTimeout(() => {
                result.innerHTML = `<span style="color: ${winningItem.color}">${winningItem.icon} ${winningItem.name}!</span>`;
                addBounty(winningItem.value);
                playSound('win');
                
                // Reset after delay
                setTimeout(() => {
                    strip.style.transition = 'none';
                    strip.style.transform = 'translateX(0)';
                    initCaseStrip();
                    btn.disabled = false;
                }, 3000);
            }, 5000);
        }

        // ==================== CHAT (FIREBASE) ====================
        async function sendChat() {
            if (!state.user) {
                openLoginModal();
                return;
            }
            
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;
            
            await db.collection('chat').add({
                sender: state.user,
                text: text,
                avatar: state.profile.avatar || '',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            input.value = '';
            addBounty(5);
        }

        function addChatMessageToDOM(sender, text, isSystem, avatar) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = 'animate-slide-up mb-4';
            
            if (isSystem) {
                div.innerHTML = `
                    <div class="text-center my-4">
                        <div class="inline-block bg-treasure-gold/20 border border-treasure-gold/50 rounded-full px-4 py-2">
                            <span class="text-treasure-gold text-xs font-bold tracking-wider uppercase">${text}</span>
                        </div>
                    </div>
                `;
            } else {
                const isMe = sender === state.user;
                const bgClass = isMe ? 'bg-blue-600/20 border-blue-500/30' : 'bg-gray-800/50 border-white/10';
                
                div.innerHTML = `
                    <div class="flex items-start space-x-3 ${isMe ? 'flex-row-reverse space-x-reverse' : ''}">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-lg border-2 border-treasure-gold/50 flex-shrink-0 overflow-hidden">
                            ${avatar ? `<img src="${avatar}" class="w-full h-full object-cover">` : sender.charAt(0)}
                        </div>
                        <div class="max-w-[80%] ${bgClass} backdrop-blur-sm p-4 rounded-2xl border ${isMe ? 'rounded-tr-sm' : 'rounded-tl-sm'}">
                            <div class="font-bold ${isMe ? 'text-blue-400' : 'text-gray-300'} text-sm mb-1">${sender}</div>
                            <div class="text-gray-200 leading-relaxed">${text}</div>
                        </div>
                    </div>
                `;
            }
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // ==================== THEORIES ====================
        async function postTheory() {
            if (!state.user) {
                openLoginModal();
                return;
            }
            
            const input = document.getElementById('theoryInput');
            const text = input.value.trim();
            if (!text) return;
            
            await db.collection('theories').add({
                author: state.user,
                text: text,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            input.value = '';
            addBounty(20);
            playSound('post');
        }

        function addTheoryToDOM(author, text, timestamp) {
            const feed = document.getElementById('theoryFeed');
            const div = document.createElement('div');
            div.className = 'glass-card p-6 rounded-xl border-l-4 border-treasure-gold animate-slide-up';
            
            const colors = ['from-luffy-red to-red-800', 'from-ocean-blue to-blue-900', 'from-purple-600 to-purple-900'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            div.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br ${randomColor} flex items-center justify-center text-white font-bold text-sm border-2 border-treasure-gold shadow-lg">
                            ${author.charAt(0).toUpperCase()}
                        </div>
                        <span class="font-bold text-gray-800 tracking-wider">@${author}</span>
                    </div>
                    <span class="text-xs text-gray-500 font-mono bg-gray-200 px-2 py-1 rounded">${timestamp ? new Date(timestamp.toDate()).toLocaleDateString('tr-TR') : 'Az √∂nce'}</span>
                </div>
                <p class="text-gray-800 leading-relaxed font-medium text-lg">${text}</p>
            `;
            
            feed.appendChild(div);
        }

        // ==================== NEWS CONTENT ====================
        function openNewsModal(type) {
            const modal = document.getElementById('newsModal');
            const content = document.getElementById('newsModalContent');
            
            const contents = {
                manga: {
                    title: "B√∂l√ºm 1174: B√ºy√ºk Mola - Elbaf ve Gelecek",
                    img: "luffy3.jpg",
                    fallback: "https://images.unsplash.com/photo-1618336753974-aae8e04506aa?w=800&q=80",
                    color: "from-luffy-red to-red-900",
                    html: `
                        <div class="prose prose-lg max-w-none text-gray-200 font-roboto leading-relaxed space-y-6">
                            <div class="bg-red-900/30 border-l-4 border-luffy-red p-6 rounded-r-xl">
                                <h2 class="text-2xl font-bold text-treasure-gold mb-4 flex items-center">
                                    <span class="mr-2">üö®</span> √ñnemliler (En Sƒ±cak Geli≈ümeler)
                                </h2>
                                
                                <h3 class="text-xl font-bold text-white mb-3">1. Manga: B√∂l√ºm 1174 ve "B√ºy√ºk Mola"</h3>
                                <p class="mb-4"><strong class="text-treasure-gold">G√ºncel Durum:</strong> Manga ≈üu an Elbaf Arkƒ±'nƒ±n zirvesinde. ƒ∞nternetteki son raporlara g√∂re 1174. B√∂l√ºm'√ºn yarƒ±n (15 ≈ûubat 2026) yayƒ±nlanmasƒ± bekleniyor.</p>
                                
                                <p class="mb-4"><strong class="text-red-400">K√∂t√º Haber (Ara):</strong> 1174. b√∂l√ºmden sonra Eiichiro Oda'nƒ±n klasik "3 b√∂l√ºm √ßiz, 1 hafta ara ver" rutini devreye girecek. Yani 22 ≈ûubat haftasƒ± manga yok.</p>
                                
                                <p class="mb-4"><strong class="text-green-400">D√∂n√º≈ü:</strong> Seri, 1 Mart 2026'da 1175. B√∂l√ºm ile geri d√∂necek.</p>
                                
                                <div class="bg-black/40 p-4 rounded-lg border border-treasure-gold/30 mt-4">
                                    <p class="italic"><strong class="text-treasure-gold">B√ºy√ºk Olay (Spoiler ƒ∞√ßerebilir):</strong> ƒ∞nternetteki sƒ±zƒ±ntƒ±lar ve tartƒ±≈ümalar, 1175. b√∂l√ºm√ºn serinin en b√ºy√ºk sava≈ülarƒ±ndan birine, Luffy vs. Imu kar≈üƒ±la≈ümasƒ±na sahne olacaƒüƒ±nƒ± (veya bu sava≈üƒ±n kƒ±zƒ±≈üacaƒüƒ±nƒ±) i≈üaret ediyor.</p>
                                </div>
                            </div>

                            <div class="bg-blue-900/30 border-l-4 border-ocean-blue p-6 rounded-r-xl">
                                <h3 class="text-xl font-bold text-white mb-3">2. Live Action (2. Sezon): Tarih Kesinle≈üti!</h3>
                                <p><strong class="text-treasure-gold">Yayƒ±n Tarihi:</strong> Netflix, One Piece Live Action 2. Sezon'un <span class="bg-treasure-gold text-black px-2 py-1 rounded font-bold">10 Mart 2026</span>'da yayƒ±nlanacaƒüƒ±nƒ± doƒüruladƒ±. Yani 1 aydan az bir s√ºre kaldƒ±.</p>
                            </div>
                        </div>
                    `
                },
                sbs: {
                    title: "SBS - Soru Cevap K√∂≈üesi: Karakter Sƒ±rlarƒ±",
                    img: "robin.jpg",
                    fallback: "https://images.unsplash.com/photo-1535701121395-c1a14c1e8c5e?w=800&q=80",
                    color: "from-purple-900 to-indigo-900",
                    html: `
                        <div class="prose prose-lg max-w-none text-gray-200 font-roboto leading-relaxed space-y-6">
                            <div class="bg-purple-900/30 border-l-4 border-purple-500 p-6 rounded-r-xl">
                                <h2 class="text-2xl font-bold text-treasure-gold mb-4">SBS (Soru-Cevap K√∂≈üesi)</h2>
                                <p class="mb-4 italic text-gray-300">Bu SBS'ler genellikle karakterlerin ki≈üisel √∂zelliklerini tanƒ±mlar ve hayranlar arasƒ±nda "canon" (resmi) bilgi kabul edilir.</p>
                                
                                <h3 class="text-xl font-bold text-white mb-4 mt-6">Eƒüer Hasƒ±r ≈ûapkalar Ger√ßek D√ºnyada Ya≈üasaydƒ± (Cilt 56)</h3>
                                
                                <div class="bg-black/40 p-6 rounded-lg border border-purple-500/30 space-y-4">
                                    <p><strong class="text-treasure-gold">Okuyucu (D):</strong> Oda-sensei! Luffy ve diƒüerleri ger√ßek hayatta olsalardƒ± hangi √ºlkeden olurlardƒ±?</p>
                                    
                                    <p><strong class="text-green-400">Oda (O):</strong> Karakterlerin g√∂r√ºn√º≈ülerine ve imajlarƒ±na dayanarak ≈ü√∂yle olurdu:</p>
                                    
                                    <ul class="grid grid-cols-2 gap-3 mt-4 text-sm">
                                        <li class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>Luffy: Brezilya</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>Zoro: Japonya</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-orange-400 rounded-full mr-2"></span>Nami: ƒ∞sve√ß</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-yellow-600 rounded-full mr-2"></span>Usopp: Afrika</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-blue-400 rounded-full mr-2"></span>Sanji: Fransa</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-pink-400 rounded-full mr-2"></span>Chopper: Kanada</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-purple-600 rounded-full mr-2"></span>Robin: Rusya</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-cyan-400 rounded-full mr-2"></span>Franky: ABD</li>
                                        <li class="flex items-center"><span class="w-3 h-3 bg-gray-400 rounded-full mr-2"></span>Brook: Avusturya</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="bg-indigo-900/30 border-l-4 border-indigo-500 p-6 rounded-r-xl">
                                <h3 class="text-xl font-bold text-white mb-4">Banyo Yapma Sƒ±klƒ±klarƒ± (Cilt 48)</h3>
                                
                                <div class="bg-black/40 p-6 rounded-lg border border-indigo-500/30 space-y-4">
                                    <p><strong class="text-treasure-gold">D:</strong> Merak ediyorum, Hasƒ±r ≈ûapka Korsanlarƒ± ne sƒ±klƒ±kla banyo yapƒ±yor?</p>
                                    
                                    <p><strong class="text-green-400">O:</strong> Bu soru √ßok geliyor. ƒ∞≈üte cevaplar:</p>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                        <div class="bg-red-900/30 p-3 rounded border border-red-500/30">
                                            <p class="font-bold text-red-400 mb-2">Haftada 1 kez:</p>
                                            <p class="text-sm">Luffy, Zoro, Brook</p>
                                        </div>
                                        <div class="bg-blue-900/30 p-3 rounded border border-blue-500/30">
                                            <p class="font-bold text-blue-400 mb-2">3 g√ºnde 1 kez:</p>
                                            <p class="text-sm">Usopp, Franky, Chopper</p>
                                        </div>
                                        <div class="bg-green-900/30 p-3 rounded border border-green-500/30 md:col-span-2">
                                            <p class="font-bold text-green-400 mb-2">Her g√ºn:</p>
                                            <p class="text-sm">Sanji, Nami, Robin</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                },
                anime: {
                    title: "Anime & Remake G√ºncellemesi",
                    img: "zoro.jpg",
                    fallback: "https://images.unsplash.com/photo-1578632767115-351597cf2477?w=800&q=80",
                    color: "from-green-800 to-emerald-900",
                    html: `
                        <div class="prose prose-lg max-w-none text-gray-200 font-roboto leading-relaxed space-y-6">
                            <div class="bg-green-900/30 border-l-4 border-green-600 p-6 rounded-r-xl">
                                <h2 class="text-2xl font-bold text-treasure-gold mb-4">Anime & Remake G√ºncellemesi</h2>
                                
                                <div class="space-y-6">
                                    <div class="bg-black/40 p-6 rounded-lg border border-green-500/30">
                                        <h3 class="text-lg font-bold text-green-400 mb-3">Mevcut Anime (Toei Animation)</h3>
                                        <p>Orijinal anime serisi de manga ile paralel olarak Elbaf d√∂nemine giri≈ü yapmƒ±≈ü durumda. Ancak manga ≈üu an √ßok kritik bir sava≈üta olduƒüu i√ßin t√ºm g√∂zler okuyucularda.</p>
                                    </div>

                                    <div class="bg-black/40 p-6 rounded-lg border border-yellow-500/30">
                                        <h3 class="text-lg font-bold text-yellow-400 mb-3">Wit Studio Remake</h3>
                                        <p class="mb-4">Sessizlik s√ºr√ºyor. Jump Festa 2026'da beklenen fragman gelmedi. Proje "yapƒ±m a≈üamasƒ±nda" denilerek ge√ßi≈ütirildi.</p>
                                        
                                        <div class="bg-yellow-900/30 p-4 rounded border border-yellow-500/30">
                                            <p class="italic text-sm"><strong class="text-yellow-400">ƒ∞nternetteki genel kanƒ±:</strong> Projenin beklenenden yava≈ü ilerlediƒüi y√∂n√ºnde.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                }
            };
            
            const data = contents[type];
            content.innerHTML = `
                <div class="relative h-64 md:h-80 overflow-hidden rounded-t-2xl">
                    <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('${data.img}'), url('${data.fallback}'), linear-gradient(to bottom, #333, #000);"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 p-8">
                        <span class="${type === 'manga' ? 'bg-luffy-red' : type === 'sbs' ? 'bg-purple-600' : 'bg-green-600'} text-white text-xs font-bold px-4 py-2 rounded-full uppercase tracking-wider shadow-lg">${type}</span>
                    </div>
                </div>
                <div class="p-8 bg-gradient-to-br ${data.color} bg-opacity-10">
                    <h2 class="font-cinzel text-3xl md:text-4xl font-bold text-white mb-6 leading-tight drop-shadow-lg">${data.title}</h2>
                    ${data.html}
                    <div class="mt-8 pt-6 border-t border-white/20 flex justify-between items-center">
                        <span class="text-gray-400 text-sm font-mono">Yayƒ±nlanma: ${new Date().toLocaleDateString('tr-TR')}</span>
                        <button onclick="closeNewsModal()" class="btn-gold text-black font-bold py-3 px-8 rounded-full shadow-lg hover:scale-105 transition-transform">KAPAT</button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeNewsModal() {
            document.getElementById('newsModal').classList.add('hidden');
            document.getElementById('newsModal').classList.remove('flex');
        }

        // ==================== OTHER FUNCTIONS ====================
        function votePoll(candidate) {
            if (state.pollVoted) return;
            if (!state.user) {
                openLoginModal();
                return;
            }
            
            state.pollVoted = true;
            addBounty(10);
            
            const pcts = { luffy: 48, buggy: 12, teach: 23, shanks: 17 };
            Object.keys(pcts).forEach(key => {
                document.getElementById(`bar-${key}`).style.width = pcts[key] + '%';
                document.getElementById(`pct-${key}`).textContent = pcts[key] + '%';
            });
            
            document.getElementById('pollMessage').classList.remove('hidden');
            playSound('coin');
        }

        function startCountdowns() {
            const targets = [
                { id: 'countdown-manga', date: new Date(Date.now() + 86400000 * 2 + 3600000 * 5) },
                { id: 'countdown-anime', date: new Date(Date.now() + 43200000 + 1800000) },
                { id: 'countdown-live', date: new Date('2026-03-10T00:00:00') }
            ];
            
            setInterval(() => {
                const now = new Date();
                targets.forEach(t => {
                    const diff = t.date - now;
                    if (diff > 0) {
                        const days = Math.floor(diff / 86400000);
                        const hours = Math.floor((diff % 86400000) / 3600000);
                        const minutes = Math.floor((diff % 3600000) / 60000);
                        const seconds = Math.floor((diff % 60000) / 1000);
                        
                        const timeStr = days > 0 
                            ? `${days}g ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
                            : `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                            
                        document.getElementById(t.id).textContent = timeStr;
                    }
                });
            }, 1000);
        }

        async function loadLeaderboard() {
            const snapshot = await db.collection('users').orderBy('bounty', 'desc').limit(5).get();
            const list = document.getElementById('leaderboardList');
            list.innerHTML = '';
            
            snapshot.docs.forEach((doc, i) => {
                const u = doc.data();
                const isMe = state.user && u.name === state.user;
                
                let medal = ['ü•á', 'ü•à', 'ü•â', '4.', '5.'][i];
                let colors = ['text-yellow-600', 'text-gray-500', 'text-orange-600', 'text-gray-400', 'text-gray-400'];
                
                li = document.createElement('li');
                li.className = 'flex justify-between items-center bg-white/60 p-4 rounded-xl border border-yellow-600/30 shadow-md';
                li.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl ${colors[i]}">${medal}</span>
                        <span class="font-bold ${isMe ? 'text-luffy-red underline decoration-treasure-gold' : 'text-yellow-900'}">${u.name} ${isMe ? '(Sen)' : ''}</span>
                    </div>
                    <span class="font-cinzel font-bold text-luffy-red text-lg">${(u.bounty || 0).toLocaleString()}‚Çø</span>
                `;
                list.appendChild(li);
            });
        }

        function playSound(type) {
            try {
                const synth = new Tone.Synth().toDestination();
                switch(type) {
                    case 'coin':
                        synth.triggerAttackRelease("C6", "8n");
                        setTimeout(() => synth.triggerAttackRelease("E6", "8n"), 100);
                        break;
                    case 'correct':
                        const poly = new Tone.PolySynth().toDestination();
                        poly.triggerAttackRelease(["C5", "E5", "G5"], "8n");
                        break;
                    case 'wrong':
                        const membrane = new Tone.MembraneSynth().toDestination();
                        membrane.triggerAttackRelease("C2", "8n");
                        break;
                    case 'spin':
                        const noise = new Tone.Noise("pink").start();
                        noise.volume.rampTo(-10, 0.1);
                        noise.stop("+4");
                        break;
                    case 'win':
                        const polyWin = new Tone.PolySynth().toDestination();
                        polyWin.triggerAttackRelease(["C4", "E4", "G4", "C5"], "4n");
                        setTimeout(() => polyWin.triggerAttackRelease(["D4", "F#4", "A4", "D5"], "4n"), 200);
                        setTimeout(() => polyWin.triggerAttackRelease(["E4", "G#4", "B4", "E5"], "2n"), 400);
                        break;
                    case 'post':
                        synth.triggerAttackRelease("G4", "16n");
                        break;
                }
            } catch(e) {
                console.log("Audio context not ready");
            }
        }

        // Modal helpers
        function openLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('flex');
        }
    </script>
</body>
</html>
